---
layout: manual
title: Integration Manual Omni Solution
description: API para integração de vendas no físico e OnLine
search: true
translated: true
toc_footers: true
categories: manual
sort_order: 1
tags:
  - API Payment
language_tabs:
  json: JSON
  shell: cURL
---

# Overview - API Omni Solution

# Proposal

Enable the integration of business partners/sub-purchasers with Cielo for transactions with non-present cards (typed transactions) and gift cards in Chip and black stripe modalities.

# Glossary

|ID|Description|
|BC|PINPad Shared Library|
|DUKPT|(Devired Unique Key Per Transaction) Encryption method used at Cielo|
|PIN|Card password|
|BDK|(Base Derived Key) Sub key to be installed on the HSM|
|HSM|(Hardware Security Module) Server for digital key generation, storage, management and cryptographic functionality|
|OAUTH2|Authentication protocol used in APIs|

# Prerequisites

For the integration, it is necessary that the business partner/sub-purchaser capture solution must have the following components:

* Shared library for PINPad or proprietary library certified with the brands.
* DUKPT encryption keys implemented for PIN.
* Make your BDK available for installation on HSM Cielo.

HSM Cielo is parameterized to a KSN as follows:

* **KSI -** Key identification number
* **DID –** Device ID
* **TC –** Transaction Counter

In the key register is only inserted the KSI that has 5 numeric characters and the key, as the example below:

**FFFFF**030331234500012

<aside class="warning">Note.: The F’s must be filled in automatically by the Capture Solution.</aside>

# Authentication

Authentication is a necessary operation to obtain the token that will be used in other API calls.

|Security scheme type:|OAuth2|
|clientCredentials OAuth Flow|**Token URL:** https://authsandbox.braspag.com.br/oauth2/token<br><br>**Scopes:**<br><br>* `Administrator` - Admin everything<br><br>* `AnalyticsApiOverview` - See the analytics<br><br>* `AdminBackoffice` - Use the backoffice|

# Payment

When a payment is created (201 - Created), you should review the Status (Payment.Status) in the response to make sure that the payment was successfully generated or if there was any failure.

| SandBox                                             | Production                                    |
|:---------------------------------------------------:|:---------------------------------------------:|
| https://apisandbox.cieloecommerce.cielo.com.br      | https://api.cieloecommerce.cielo.com.br/      |

## Credit card typed sales without password

### Request

<aside class="request"><span class="method post">POST</span> <span class="endpoint">/1/physicalSales/</span></aside>

```json
{
  "MerchantOrderId": "201904150001",
  "Payment": {
    "Type": "PhysicalCreditCard",
    "SoftDescriptor": "Description",
    "PaymentDateTime": "2019-04-15T12:00:00Z",
    "Amount": 15798,
    "Installments": 1,
    "Capture": true,
    "Interest": "ByMerchant",
    "ProductId": 1,
    "CreditCard": {
      "CardNumber": 1234567812345678,
      "ExpirationDate": "12/2020",
      "SecurityCodeStatus": "Collected",
      "SecurityCode": 1230,
      "BrandId": 1,
      "IssuerId": 2,
      "InputMode": "Typed",
      "AuthenticationMethod": "NoPassword",
      "TruncateCardNumberWhenPrinting": true
    },
    "PinPadInformation": {
      "TerminalId": "10000001",
      "SerialNumber": "ABC123",
      "PhysicalCharacteristics": "PinPadWithChipReaderWithSamModule",
      "ReturnDataInfo": "00"
    }
  }
}
```

Property|Type|Size|Required|Description|
|---|---|---|---|---|
|`MerchantOrderId`|String|---|---| Document number automatically generated by the terminal and incremented by 1 for each transaction made at the terminal.|
|`Payment.Type`|String|---|Yes|Value: `PhysicalCreditCard` / Transaction Type|
|`Payment.SoftDescriptor`|String|13|---|Identification of the establishment (short name) to be printed and identified on the invoice.|
|`Payment.PaymentDateTime`|String|date-time|Yes|Transaction capture Date and Time|
|`Payment.Amount`|Integer(int64)|---|Yes|Transaction amount (1079 = R$10,79)|
|`Payment.Capture`|Booleano|---|---|Default: false / Boolean that identifies that the authorization must be with auto capture. Authorization without automatic capture is also known as pre-authorization.|
|`Payment.Installments`|Integer|---|---|Default: 1 / Quantidade de Parcelas: Varia de 2 a 99 para transação de financiamento. Deve ser verificado os atributos maxOfPayments1, maxOfPayments2, maxOfPayments3 e minValOfPayments da tabela productTable.|
|`Payment.Interest`|String|---|---|Default: `ByMerchant` <br><br> Enum: `ByMerchant` `ByIssuer` <br><br> Installment Type: <br><br> - If bit 6 of the confParamOp05 attribute present in the issuerTable and binTable tables and bit 6 of the confParamOp03 attribute of the productTable table are all enabled indicates that the interest-free installment type can be made. <br> <br> - If bit 7 of the confParamOp05 attribute, present in the issuerTable and binTable tables and bit 7 of the confParamOp03 attribute of the productTable table are all enabled, it indicates that the interest installment type can be made. No interest = "ByMerchant"; With interest = “ByIssuer”.|
|`Payment.ProductId`|Integer|---|Yes|Product code identified via card bin.|
|`CreditCard.CardNumber`|String|19|---|Card number (PAN)|
|`CreditCard.ExpirationDate`|String|MM/yyyy|Yes|Card Expiration Date <br><br>Data obtained through the command PP_GetCard in BC at the time of the transaction capture.
|`CreditCard.SecurityCodeStatus`|String|---|---|Enum: `Collected` `Unreadable` `Nonexistent` <br><br> Security code collection status (CVV)|
|`CreditCard.SecurityCode`|String|3 or 4|---|Security code (CVV)|
|`CreditCard.BrandId`|Integer|---|Yes|Brand identification obtained through the BrandId field from the PRODUCT TABLE.|
|`CreditCard.IssuerId`|Integer|---|Yes|Issuer code obtained through IssuerId field from the BIN TABLE.|
|`CreditCard.InputMode`|String|---|Yes|Enum: `Typed` `MagStripe` `Emv` <br><br>Identification of card capture mode in the transaction. This information must be obtained through the return of BC's PP_GetCard function. <br><br> "00" - Magnetic <br><br> "01" - VISA Cash Coin on TIBC v1 <br><br> "02" - VISA Cash Coin on TIBC v3 <br><br> "03" - EMV with contact <br><br> "04" - Easy Entry on TIBC v1 <br><br> "05"- Contactless chip simulating the black stripe" 06 "- Contactless EMV. |
|`CreditCard.AuthenticationMethod`|String|---|Yes|Enum: `NoPassword` `OnlineAuthentication` `OfflineAuthentication` <br><br>Authentication method <br><br>- If the card was read from typing, check bit 3 of the confParamOp04 attribute of the binTable, parameterTable and issuerTable tables. 
If all are enabled, the password must be captured and authenticationMethod assumes value 2. Otherwise, assume value 1; <br><br>-If the card was read from the track, check bit 3 of the confParamOp04 attribute of the binTable, parameterTable and issuerTable tables. If all are enabled, then check bit 2 of the same field. If this value is 1, the password must be captured. If it is set to 0, password capture will depend on the last digit of the service code; <br><br>- If the card was read through the EMV chip, the authenticationMethod will be populated based on the return of the PP_GoOnChip function(). No resultado PP_GoOnChip(), where if the field of position 003 of the return from PP_GoOnChip () and if the position field 003 of the return from PP_GoOnChip() value 1 indicates the the pin has been validated offline, the authenticationMethod will be 3. If the position field 003 and the position field 006 of the return from PP_GoOnChip () are with the value set to 0, the authenticationMethod will be 1. If the position field 003 and the position field 006 of the return from PP_GoOnChip() are with values ​​0 and 1 respectively, the authenticationMethod will be 2. <br><br>1 - No password = “NoPassword”; <br><br>2 - Online password = “Online Authentication”; <br><br>3 - Offline password = “Offline Authentication”.|

