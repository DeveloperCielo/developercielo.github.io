---
layout: manual
title: Manual de integração
description: Integração Técnica via API
search: true
translated: true
categories: manual
sort_order: 1
tags:
  - Cielo LIO
language_tabs:
  json: JSON
---

# Bem-vindo a Cielo!

Nessa documentação você tem acesso a todas as informações sobre as plataformas de desenvolvimento da Cielo bem como suas principais funcionalidades para integrar com seu negócio.

O objetivo dessa documentação é facilitar o processo de desenvolvimento e integração com a Cielo

Caso você deseje ser cliente Cielo e possuir uma de nossas soluções de pagamento, acesse https://www.cielo.com.br/seja-nosso-cliente/ e escolha a solução ideal para você vender muito mais.

# Visão Geral da Plataforma

## Sobre

A Cielo LIO é plataforma que fornece controle e gestão de negócios que vai além de um sistema de pagamentos tradicional. Essa plataforma suporta aplicativos desenvolvidos para sistema Android, incentivando desenvolvedores parceiros a criar aplicativos especializados para diversos segmentos (restaurantes, vestuário, cosméticos, combustível e outros) e, assim, permitindo que estabelecimentos comerciais escolham o aplicativo que melhor se adapte ao modelo de negócio da empresa.

Quer conhecer mais sobre o produto Cielo LIO? Acesse: http://cielolio.com.br

## Modelos disponíveis da Cielo LIO

Atualmente a Cielo LIO está disponível em 2 modelos: LIO V1 e LIO V2

Ambos os modelos foram desenvolvidos pela Cielo pensando em atender as necessidades específicas de alguns clientes.

Enquanto a LIO V1 possui um design mais compacto e permite uma maior mobilidade, a LIO V2 foi concebida em um tamanho maior e possui algumas funcionalidades exclusivas e adicionais como por exemplo:

**Impressora térmica**: o cliente poderá ter a 1ª e 2ª via impressa após o pagamento realizado. Além disso, as aplicações parceiras poderão utilizar os métodos disponíveis da impressora para imprimir dados importantes ou necessários para o negócio do cliente.

**NFC**: tecnologia presente permitindo o pagamento utilizando cartões com tecnologia contactless.

## Arquitetura

### Sobre

A plataforma Cielo LIO é baseada em Android que consiste em:

* Uma loja de aplicativos (Cielo Store) para os desenvolvedores publicarem seus aplicativos e os disponibilizarem para os estabelecimentos comerciais (lojistas).
* Uma plataforma com arquitetura em nuvem e APIs REST que permite a integração com sistemas de automação comercial de parceiros.
 Acesse Documentação da Integração Remota
* Um SDK para desenvolvimento em Android, de forma que aplicativos de parceiros possam se integrar com as funcionalidades de pagamento da Cielo LIO. 
Acesse Documentação da Integração Local

### Modelos de integração com a plataforma Cielo LIO

#### Integração Remota | Cielo LIO Order Manager**

Conjunto de APIs que permitem que o cliente continue utilizando sua solução de PDV / Automação Comercial com todas as funcionalidades. No momento de realizar o pagamento, ocorre a integração com o gerenciador de pedidos (Order Manager) da Cielo LIO, de forma rápida, simples e segura.

#### Integração Local | Cielo LIO Order Manager SDK

A Cielo disponibiliza um SDK com base na Cielo LIO Order Manager API que permite ao desenvolvedor e parceiro Cielo LIO integrar em sua aplicação as funcionalidades da Cielo LIO.

### Serviços periféricos

A Cielo LIO também se integra com os seguintes periféricos de hardware:

**Impressoras Bluetooth**

No caso da LIO V1 é possível conectar a Cielo com impressoras bluetooth para realizar a impressão de recibos e outras informações importantes.

Já existem parceiros que estão utilizando impressoras Bluetooth das marcas Zebra, Datex, Leopardo integradas com a Cielo LIO.

Todos os protocolos de comunicação e pareamento ficam sob responsabilidade do aplicativo do parceiro.

**Leitores de RFID**

Já existem parceiros que estão utilizando leitores RFID em suas soluções.

Todos os protocolos de comunicação e pareamento ficam sob responsabilidade do aplicativo do parceiro.

## Especificações técnicas do hardware da Cielo LIO

A plataforma Cielo LIO teve seu sistema operacional próprio baseado em Android.
Confira abaixo a tabela com as especificações técnicas da Cielo LIO:

| Versão               | LIO v1                                      | LIO v2                                      |
|----------------------|---------------------------------------------|---------------------------------------------|
| Sistema operacional  | Android OS Cielo 5.1.1                      | Android OS Cielo 6.0 (Marshmallow)          |
| Memória              | 2GB LPDDR3                                  | 1GB LPDDR3                                  |
| Dual Chip            | Dual SIM Stand-by                           | Dual SIM Stand-by                           |
| Tipo do SIM Card     | micro SIM (3FF)                             | micro SIM (3FF)                             |
| Frequência GSM Mhz   | Quad-Band 850/900/1800/1900                 | Quad-Band 850/900/1800/1900                 |
| Tamanho em polegadas | 5"                                          | 5.5"                                        |
| Tipo de tela         | AMOLED                                      | AMOLED                                      |
| Resolução da tela    | 720 x 1280 pixels                           | 720 x 1280 pixels                           |
| Densidade de pixels  | 293 ppi                                     | 267 ppi                                     |
| Câmera               | 12.8 Mega Pixels                            | 13 Mega Pixels                              |
| Resolução da câmera  | 4128 x 3096 pixels                          | 4160 x 3120 pixels                          |
| Flash                | Flash LED                                   | Flash LED                                   |
| USB                  | USB 2.0 Micro-B (Micro-USB) Somente Energia | USB 2.0 Micro-B (Micro-USB) Somente Energia |
| Bluetooth            | Versão 4.0 com A2DP                         | Versão 4.0 com A2DP/LE                      |
| WiFi                 | 802.11 a/b/g/n                              | 802.11 b/g/n                                |
| GPS                  | A-GPS. GeoTagging                           | A-GPS                                       |
| Sensores             | Acelerômetro, Proximidade e Luminosidade    | Acelerômetro, Proximidade e Luminosidade    |
| Saída de áudio       | Audio Jack 3.5mm                            | Audio Jack 3.5mm                            |
| Peso                 | 363 g                                       | 507 g                                       |
| Altura               | 34mm                                        | 46mm                                        |
| Largura              | 84mm                                        | 81mm                                        |
| Comprimento          | 168mm                                       | 228mm                                       |

## Rotação de tela na Cielo LIO

As rotações na tela de exibição possuem comportamento diferente entre as versões da Cielo LIO.

Na LIO V1 a orientação da tela é travada.

Na LIO V2 é possível controlar a orientação da tela. Por padrão, a orientação da tela exibida é livre e definida de acordo com o acelerômetro do equipamento.

Caso o desenvolvedor deseje controlar e usar de forma personalizada a orientação de tela da Cielo LIO, este deverá utilizar de acordo com a documentação do Android.

https://developer.android.com/guide/topics/manifest/activity-element.html

Acesse o item: android:screenOrientation para obter maiores informações.

## Dados Móveis na Cielo LIO

A Cielo LIO já vem configurada com um SIM Card. A operadora do SIM Card é definida de acordo com o endereço de cadastro do estabelecimento comercial.

A Cielo envia o SIM Card da melhor operadora de acordo com o endereço de cadastro da LIO solicitada.

Esse SIM Card permite a conexão com a tecnologia 3G da Cielo LIO e possui um pacote de dados ilimitado.

# Guia para desenvolvedores

O guia abaixo fornece as informações necessárias para ajudar os desenvolvedores a integrar ou desenvolver seus aplicativos na plataforma Cielo LIO da melhor maneira possível, de modo a oferecer uma experiência excelente para os estabelecimentos comerciais.

Recomenda-se a leitura detalhada na documentação da Cielo LIO presente no Portal de Desenvolvedores. Essa documentação reúne informações importantes para questões de simplicidade moderada

## Melhores práticas com a plataforma Cielo LIO

### Segurança de dados e Privacidade

* Proteja os dados confidenciais de clientes e funcionários. Não exponha publicamente nomes, endereços ou números de telefone.
* Nunca exponha tokens de autenticação ou senhas de qualquer tipo.
* Em caso de utilizar o recurso Webview, este só deve carregar conteúdo dentro do seu controle e não permitir que os usuários naveguem para páginas da Web arbitrárias (barra de navegação).
* O parceiro deve fornecer os seus dados de suporte para que os estabelecimentos comerciais (lojistas) entrem em contato no caso de problemas e/ou dúvidas.

### Rate Limiting

* As solicitações da Automação Comercial ou PDV devem ser escalonadas o máximo possível para evitar rajadas de alto volume de tráfego.
* “Cache” seus próprios dados quando você precisar armazenar valores especializados ou revisar rapidamente conjuntos de dados muito grandes.
* Não crie multi-thread com chamadas POST, pois esse comportamento pode criar atrasos sistêmicos devido a deadlocks.
* Minimize o uso de dados. Os estabelecimentos comerciais (lojistas) podem estar utilizando conexão com dados móveis limitados.

### Código de Qualidade

Seu aplicativo deve estar em conformidade com as práticas de programação Java e Android convencionais de acordo com as diretrizes para desenvolvedores do Android.

* Princípios de Design Orientado a Objetos (S.O.L.I.D.).
* Diretrizes de estilo Java.
* Entenda a diferença entre compileSdkVersion, targetSdkVersion, e minSdkVersion.
* Aproveite os botões nativos do Android, como os botões “Voltar” e “Início”.
* Otimize as operações visando o baixo consumo da bateria
* O aplicativo deve atender às necessidades dos estabelecimentos comerciais (lojistas) da Cielo.
* Seu aplicativo deve ter uma boa experiência de ponta a ponta, garantindo a comunicação correta entre todos os fluxos, principalmente os retornos de pagamento da Cielo LIO.

### Recursos de imagem

* Os ícones dos aplicativos devem ser recursos do mipmap.
* Os ícones devem estar em conformidade com o dimensionamento padrão do Android (você pode usar geradores de ícones de terceiros para redimensionar seu logotipo): 192 × 192 (xxxhdpi).

### Utilização e Usabilidade

* Recomendamos aos desenvolvedores que integrem algum tipo de utilitário de relatório de falhas em seus produtos Android. Isso ajudará você a manter a consciência operacional do seu produto.
* Os desenvolvedores podem coletar métricas sobre o uso do seu aplicativo. Isso irá ajudá-los a construir melhores produtos e aumentar a conscientização a respeito de quaisquer questões impactantes.
* Garantir que o aplicativo funcione de forma otimizada, evitando que ocorram crash e demora na resposta por processamento da aplicação. Seu aplicativo será usado em condições de trabalho de ritmo rápido e dinâmico, portanto esforce-se para obter fluxos de trabalho claros, fáceis de usar e robustos, com o mínimo de passos possível.
* O design deve enfatizar clareza e acessibilidade – alto contraste, fontes legíveis, texto grande e entradas.
* Deixar claro os termos de aceite da aplicação e prover o suporte necessário ao usuário no que tange o serviço disponibilizado.
* Se você estiver adaptando um aplicativo desenvolvido para outra plataforma, verifique se ele só inclui recursos e botões relevantes para o usuário da Cielo LIO.
* Se o seu aplicativo incluir um componente voltado para o cliente, seu projeto refletirá sobre o negócio usando seu aplicativo. Essas interfaces devem ser agradáveis e profissionais.
* Recomenda-se a utilização do [Material Design](https://material.io) para desenvolvimento das aplicações para a Cielo LIO. Esta recomendação tem como objetivo facilitar o uso de boas práticas de design para o desenvolvimento de aplicações móveis.
* Seu aplicativo será usado em condições de trabalho de ritmo rápido e dinâmico. Esforce-se para obter fluxos de trabalho claros, fáceis de usar e robustos, com o mínimo de passos possível.

# Desenvolva seu aplicativo para Cielo LIO

## Introdução

Com a Cielo LIO é possível que empresas e parceiros tenham seu aplicativo rodando na plataforma da Cielo. Esses aplicativos podem ou não estar integrados com o pagamento, tudo vai depender da finalidade da empresa ou parceiro.

Abaixo, você encontra todas as informações necessárias para desenvolver um aplicativo para a Cielo LIO.

## Ambiente de Desenvolvimento

É necessário que você utilize uma IDE (Integrated Development Environment) para desenvolvimento do seu aplicativo. A Cielo recomenda que seja utilizada a IDE do Android Studio (versão 2.2.2 ou superior), visando garantir o funcionamento do aplicativo na plataforma Cielo LIO.

Para mais detalhes sobre a instalação e configuração do Android Studio, [clique aqui](https://developer.android.com/index.html)
Para a criação de um novo projeto no Android Studio, [clique aqui](https://developer.android.com/training/basics/firstapp/creating-project.html)

## Linguagem de Programação

A Cielo LIO aceita aplicativos desenvolvidos em Java ou Kotlin.

Recomendamos que essas linguagens sejam utilizadas para garantir o funcionamento e facilidade de integração com a Cielo LIO.

## Cielo OS

O sistema operacional da plataforma Cielo LIO foi personalizado e, com isso, surgiu o Cielo OS, que é baseado em Android.

Na LIO V1, o sistema operacional é baseado no Android 5.1.1 (API Level 22) e disponibiliza a maioria das APIs presentes no framework do Android.

Na LIO V2, o sistema operacional é baseado no Android 6.0 (API Level 23) e disponibiliza a maioria das APIs presentes no framework do Android.

Caso queira consultar quais APIs estão disponíveis, acesse https://developer.android.com/reference/packages.html e selecione “API Level 22” ou “API Level 23” no canto esquerdo da tela, de acordo com sua preferência.

## Versão target da aplicação

Recomenda-se que o desenvolvedor utilize como versão target da aplicação o Android 5.1.1 (Lollipop).

Dessa forma, garante-se o funcionamento da aplicação no hardware da LIO V1 como também no hardware da LIO V2.

## Recursos Indisponíveis

Ao personalizar o Android da Cielo LIO, foram removidos alguns recursos para garantir o desempenho e a segurança da plataforma.

Seguem abaixo os recursos removidos da Cielo LIO:

**Google Play Services**: Todos os serviços, APIs e apps do Google foram removidos do sistema operacional. Consequentemente, não será possível utilizar as bibliotecas que dependem desses recursos do Google.

**Componente Webview**: Este recurso visual foi removido com o objetivo de garantir a segurança na plataforma e evitar que, a partir dos aplicativos instalados na Cielo LIO, seja possível acessar links e conteúdos externos.

> **Atenção**: A Cielo não permite que o aplicativo do cliente/parceiro seja desenvolvido utilizando o recurso WebView. Esse recurso visual deixa a plataforma da Cielo LIO vulnerável. Caso a aplicação esteja utilizando o WebView, esta não atenderá aos parâmetros de certificação e não será disponibilizada na Cielo Store.

## APKs Removidas do Cielo OS

Abaixo, segue uma tabela com todas as APKs que foram removidas do Cielo OS e que, consequentemente, não estão disponíveis para a Cielo LIO:

||||
|------------------|----------------------|-------------------------|
| BasicSmsReceiver | FileManager          | PhaseBeam               |
| Browser          | Galaxy4              | QuickSearchBox          |
| Calculator       | Gallery              | SoundRecorder           |
| Calendar         | HoloSpiralWallpaper  | SpeechRecorder          |
| CalendarProvider | LiveWallpapers       | Todos                   |
| CBMessageWidget  | LiveWallpaperPicker  | Videos                  |
| Contacts         | MagicSmokeWallpapers | VisualizationWallpapers |
| ContactsCommon   | MtkWeatherProvider   | VoiceCommand            |
| DataTransfer     | Mms                  | VoiceDialer             |
| Dialer           | Music                | VoiceExtension          |
| Email            | MusicFX              | VoiceUnlock             |
| Exchange2        | NlpService           | WallpaperCropper        |
| FMRadio          | NoiseField           |                         |

## Frameworks de Desenvolvimento

Atualmente Cielo LIO ainda não dá suporte a aplicativos desenvolvidos em plataformas híbridas, como, por exemplo, Ionic, Titanium, Xamarin, CronApp e PhoneGap.

## Recursos e métodos úteis Cielo LIO

A Cielo removeu alguns recursos da Plataforma Cielo LIO visando garantir a segurança e integridade da mesma para desenvolvedores e lojistas.

Portanto, abaixo disponibilizamos algumas alternativas que podem a vir substituir a ausência desses recursos.

| Push-Notifications                                                                                                                                                                                                                                                                                                                                                                                                                             | Serviços de Localização (GPS)                                                                                                                                                                                                                                                                                                                  | Serviços de Mapas                                                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recurso exclusivo do Google Services, portanto não está presente na Cielo LIO.                                                                                                                                                                                                                                                                                                                                                                 | Recurso exclusivo do Google Services, portanto não está presente na Cielo LIO.                                                                                                                                                                                                                                                                 | Recurso exclusivo do Google Services, portanto não está presente na Cielo LIO.                                                                                                                        |
| **Alternativa**: JobScheduler                                                                                                                                                                                                                                                                                                                                                                                                                  | **Alternativa**: Location Manager                                                                                                                                                                                                                                                                                                              | **Alternativa**: MapBox                                                                                                                                                                               |
| **Descrição**: É uma API para agendar vários tipos de trabalhos contra a estruturaque será executada no próprio processo da sua aplicação.Permitindo a cada ciclo de tempo que o aplicativo realize uma buscaem nossos serviços de Backend.O JobScheduler éo mais indicado devido a performance em relação ao uso de bateria,fora as muitas outras opções que ele disponibiliza (Ex: Job rodarsomente quando o smartphone estiver carregando). | **Descrição**: Essa classe fornece acesso aos serviços de localização do sistema.Esses serviços permitem que os aplicativos obtenham atualizaçõesperiódicas da localização geográfica do dispositivo ou queiniciem uma Intenção especificada pela aplicação quando odispositivo entra na proximidade de uma determinada localizaçãogeográfica. | **Descrição**: Uma plataforma de mapeamento de código aberto para mapaspersonalizados. Nossas APIs e SDKs são os blocos de construçãopara integrar a localização em qualquer aplicativo móvel ou web. |
| **Referência**: [Clique aqui](https://developer.android.com/reference/android/app/job/JobScheduler.html)                                                                                                                                                                                                                                                                                                                                       | **Referência**: [Clique aqui](https://developer.android.com/reference/android/location/LocationManager.html)                                                                                                                                                                                                                                   | **Referência**: [Clique aqui](https://www.mapbox.com)                                                                                                                                                 |

Agora que você já tem as informações necessárias para desenvolver um aplicativo para, acesse a documentação da Integração Local para saber como se integrar com o SDK da Cielo LIO.

[Clique aqui](https://developercielo.github.io/manual/cielo-lio#integração-local)

# Integração Remota

## Apresentação

O objetivo da Integração Remota da Cielo LIO é permitir que o lojista continue utilizando sua solução de frente de caixa (Automação Comercial ou PDV) e a integre com o módulo de pedidos e pagamentos da Cielo LIO através de uma API construída no padrão RESTful.

Dessa forma, toda a gestão do estabelecimento comercial fica sob responsabilidade da Automação Comercial e, no momento de realizar o pagamento, a Cielo LIO é utilizada.

![integração remota](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/diagrama-overview.jpg)

A API Order Manager da Cielo LIO possui as seguintes características:

* Recursos REST, de forma que seja possível acessar por meio de semântica HTTP padrão.
* Códigos de status HTTP para comunicar o sucesso/erro nas chamadas.
* Todas as requisições e respostas encontram-se no formato JSON.
* As seções abaixo possuem todas as informações necessárias para realizar a integração de forma rápida e segura.

## Vídeo Demo

No vídeo abaixo é possível ver um exemplo de Automação Comercial integrada com a API Order Manager da Cielo LIO.

[![Vídeo Demo](https://img.youtube.com/vi/QxfTkJEN1Qs/0.jpg)](https://www.youtube.com/watch?v=QxfTkJEN1Qs)

Clique na imagem acima, para acessar o vídeo.

### Code Sample

O código do exemplo da Automação Comercial integrada com a API Order Manager da Cielo LIO encontra-se disponível no [GitHub](https://github.com/cielolabsbr/SampleAutomacaoComercial1.2).

## Fluxo para Integração

![fluxo integração remota](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/fluxogram-remote-new.png)

## API Docs

Nessa documentação, o desenvolvedor encontra todas as informações sobre os Endpoints, Entidades e Recursos disponíveis na API.

Você poderá consultar os dados de entrada, exemplos de requisição e os dados de saída. Assim como entender o fluxo básico da utilização da API Order Manager da Cielo LIO.

### Endpoints

Todas as chamadas devem ser executadas utilizando as respectivas credenciais dos ambientes de sandbox e produção.

#### Sandbox

O ambiente de sandbox é destinado à realização de testes com parceiros da Cielo. Esse ambiente usa simuladores de integração. Assim, as operações não são executadas em ambiente produtivo.

Para utilizar o ambiente de sandbox, não é necessário que você forneça o número do estabelecimento. Você poderá iniciar os testes sem a necessidade de ter uma Cielo LIO. Para obter os tokens de sandbox, crie uma conta no portal e crie o Client-Id.

Utilize o endereço de sandbox abaixo para realizar os testes:

> https://api.cielo.com.br/sandbox-lio/order-management/v1

#### Produção

O ambiente de produção é o ambiente transacional integrado ao ambiente da Cielo. As operações realizadas nesse ambiente não podem ser desfeitas.

Para utilizar o ambiente de produção, é necessário que você entre em contato através do formulário. Juntamente com os dados pessoais, forneça o número do estabelecimento. Para utilizar o ambiente de produção, é necessário que você possua uma Cielo LIO.

Utilize o endereço de produção abaixo para realizar as requisições:

> https://api.cielo.com.br/order-management/v1

Já fez os testes em sandbox e deseja solicitar os tokens?

Clique em [Solicitar Tokens](https://desenvolvedores.cielo.com.br/api-portal/content/solicitar-tokens-para-producao) ou acesse o menu “Desenvolvedor” no Portal de Desenvolvedores e escolha a opção "Solicitar tokens”.

É necessário estar logado!

### HTTP Headers

Todas as chamadas da API Integração Remota Cielo LIO Order Manager necessitam que as informações abaixo estejam presentes no Header na requisição:

**Client-Id**: Identificação de acesso. Sua geração ocorre no momento da criação pelo painel do desenvolvedor. Seu valor pode ser visualizado na coluna “Client ID”, dentro do menu “Desenvolvedor” -> “Client ID Cadastrados”.

**Access-Token**:Identificação do token de acesso, que armazena as regras de acesso permitidas ao Client ID. Sua geração ocorre no momento da criação do Client ID pelo painel do desenvolvedor. Seu valor pode ser visualizado clicando em “detalhes” na coluna “Access Tokens”, dentro do menu “Desenvolvedor” -> “Client ID Cadastrados”.

**Merchant-Id**: Token que identifica o estabelecimento comercial dentro do servidor Order Manager da Cielo LIO. Sua geração ocorre durante o processo de cadastro do Client ID. Seu valor pode ser visualizado na coluna “Merchant ID”, dentro do menu “Desenvolvedor” -> “Client ID Cadastrados”.

### HTTP Status Code

| Código  | Erro  | Descrição  |
|---|---|---|
| 200 |  OK | Operação realizada com sucesso.  |
| 201 | Created  | A solicitação foi realizada, resultando na criação de um novo recurso.  |
| 204 | Empty  |  Operação realizada com sucesso, mas nenhuma resposta foi retornada. |
| 400  | Bad Request  |  A requisição possui parâmetro(s) inválido(s). |
| 401  | Unauthorized  | O token de acesso não foi informado ou não possui acesso às APIs.  |
| 403  | Forbidden  | O acesso ao recurso foi negado.  |
| 404  | Not Found  | O recurso informado no request não foi encontrado.  |
| 413  | Request is to Large  |  A requisição está ultrapassando o limite permitido para o perfil do seu token de acesso. |
| 422  | Unprocessable Entity  | A requisição possui parâmetros obrigatórios não informados.  |
| 429  | Too Many Requests  | O consumidor estourou o limite de requisições por tempo.  |
| 500  | Internal Server Error  | Erro não esperado; algo está quebrado na API  |

### Status de pedido

Abaixo é apresentada uma máquina de estados, com os possíveis estados que um pedido pode assumir desde o momento de sua criação até o seu término:

![status do pedido](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/diagrama-lifecycle-new.png)

### Entidades

#### Order

A Order é uma representação de um pedido para a venda de um ou mais produtos e/ou serviços. É fundamental que exista uma Order para que um pagamento seja realizado na Cielo LIO.

| Campo  |  Tipo | Descrição  | Obrigatório  |
|--------|-------|------------|--------------|
| id  |  Texto |  UUID que identifica unicamente o pedido. | Sim  |
| number  | Texto  | Número do pedido. Geralmente, esse número representa o identificador do pedido em um sistema externo através da integração com parceiros.  | Não  |
|  reference |  Texto | Referência do pedido. Utilizada para facilitar o acesso ou a localização do mesmo.  |  Não |
| status  | Texto  | Status do pedido (ENTERED, RE-ENTERED, PAID, CANCELED e CLOSED).  |  Sim |
| created_at  | Texto  | Data de criação do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z).  | Sim  |
| updated_at  |  Texto | Data da última atualização do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z).  | Sim  |
| items  |Lista (Order Item)   | Lista de itens contidos no pedido.  |  Sim |
|  notes | Texto  | Campo disponível para uso do Merchant para comunicação.  | Não  |
| transactions  | Lista (Transaction)|  Lista de transações de pagamento (ou outros tipos) efetuadas no pedido. | Sim  |
| price  | Número  |  Valor total do pedido. Exemplo: O valor de R$ 10,00 é representado como 1000. |  Sim |
|  remaining |  Número |Valor restante do pagamento do pedido. Exemplo: O valor de R$ 10,00 é representado como 1000.   |  Sim |

#### Order Item

O Order Item é uma representação dos itens presentes em uma Order. É obrigatória a existência de, no mínimo, um Item para uma Order.

| Campo  | Tipo  | Descrição  |  Obrigatório |
|--------|-------|------------|--------------|
| sku  | Texto  | SKU do produto. Exemplo: c2f5fb9a-5542-406e-8b79-17892329cda8.  | Sim  |
| name | Texto | Nome do produto.| Não |
| description | Texto | Descrição do produto.| Não |
| unit_price | Número | Valor unitário do produto. Exemplo: O valor de R$ 10,00 é representado como 1000. | Sim |
|quantity|Número|Quantidade de itens. Caso não seja informado, será considerado o valor 1.|Não|
| unit_of_measure | Texto | Unidade de medida (EACH, HOURS, DAYS, SECONDS, CRATE_OF_12, SIX_PACK, GALLON e LITRE).| Sim |
|details|Texto|Detalhes do produto.|Não|
|created_at|Texto|Data de criação do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z).|Não|
| updated_at | Texto | Data de última atualização do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z). | Sim |

#### Transaction

A Transaction é uma representação com todos os pagamentos que foram realizados em uma Order. O objetivo é utilizá-la para consultar os pagamentos (transactions) que foram efetuados em uma Order.

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|Texto|"UUID" que identifica unicamente a transação.|Sim|
|transaction_type|Texto|Tipo da transação (PAYMENT e CANCELLATION).|Sim|
|status|Texto|Status da transação (CONFIRMED, PENDING e CANCELLED).|Sim|
|description|Texto|Descrição da transação.|Não|
|terminal_number|Número|Número do terminal da Cielo LIO em que o pagamento foi realizado.|Sim|
|card|Card (Card)|Informações sobre o cartão utilizado na transação.|Sim|
|number|Número|Número Sequencial Único (NSU) da transação.|Sim|
|authorization_code|Número|Código de autorização da transação.|Sim|
|payment_product|Payment Product (Payment Product)|Informações sobre o produto de pagamento utilizado.|Sim|
|amount|Número|Valor da transação. Exemplo: O valor de R$ 10,00 é representado como 1000.|Sim|
|created_at|Texto|Data de criação do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z).|Sim|
|updated_at|Texto|Data de última atualização do pedido. A data deve estar no formato: YYYY-MM-DDThh:mm:ssZ (Exemplo: 20151020T13:13:29.000Z).|Sim|

#### Card

O Card é uma representação do cartão que foi utilizado para realizar o pagamento/transação.

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|brand|Texto|Bandeira do cartão (VISA e MASTER).|Sim|
|bin|Número|Bin (primeiros 6 dígitos) do cartão.|Sim|
|last|Número|Last (últimos 4 dígitos) do cartão.|Sim|

#### Payment Product

O Payment Product é uma representação da forma de pagamento utilizada para realizar um pagamento.
Ex.: Crédito, Débito, etc.

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|number|Texto|Identificação numérica do produto primário da Cielo.|Sim|
|name|Número|Nome do produto primário utilizado.|Sim|
|sub|Número|Produto secundário.|Sim|

#### Sub Payment Product

O Sub Payment Product é uma representação com o complemento da forma de pagamento utilizada para realizar um pagamento.
Ex.: À Vista, Parcelado, etc.

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|number|Texto|Identificação numérica do produto primário da Cielo.|Sim|
|name|Número|Nome do produto primário utilizado.|Sim|

### Recursos

#### POST - Criar um pedido

Esse recurso realiza a criação de um pedido no servidor do Order Manager.

> Endpoint:
> 
> **POST** /orders

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|order|Order|Informações do pedido.|Sim|

Exemplo de requisição:

```json
{
    "number": "0992f1d5cee540d9a9648f4d6a9e4aa6",
    "reference": "PEDIDO #1234",
    "status": "DRAFT",
    "items": [{
            "sku": "ede8f84a8b8645cb8e576a593c25c6ed",
            "name": "produto 1",
            "unit_price": 500,
            "quantity": 2,
            "unit_of_measure": "EACH"
        },
        {
            "sku": "c2f5fb9a5542406e8b7917892329cda8",
            "name": "produto 2",
            "unit_price": 1500,
            "quantity": 3,
            "unit_of_measure": "EACH"
        },
        {
            "sku": "b2j4bn6j93461385r5n90453407hjk0",
            "name": "produto 3",
            "unit_price": 550,
            "quantity": 3,
            "unit_of_measure": "EACH"
        },
        {
            "sku": "55329cda842406e8cv2f5gdf96985152d",
            "name": "produto 4",
            "unit_price": 2005,
            "unit_of_measure": "EACH"
        }
    ],
    "notes": "Mesa 1",
    "price": 9155
}
```

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|body|Identificador do pedido.|Sim|

Exemplo de resposta:

```json
{
    "id": "2e1d7b07-dcee-4a09-8d09-3bb02d94169d"
}
```

#### GET - Consultar pedido

Esse recurso é utilizado para obter informações sobre um pedido específico. O id do pedido é utilizado para realizar a chamada.

> Endpoint:
> 
> **GET** /orders<id>

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|

Exemplo de requisição:

> **GET** https://api.cielo.com.br/order-management/v1/orders/c393ce9f-3741-413f-8ad5-2f142eaed51f

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|order|Order|Informações sobre o pedido consultado.|Não|

Exemplo de resposta:

```json
{
    {
    "id": "b4d8a7dc-4250-48a3-bf18-d560d4508368",
    "number": "0992f1d5-cee5-40d9-a964-8f4d6a9e4aa6",
    "reference": "LOJA SUCO #1",
    "status": "ENTERED",
    "notes": "Mesa 6",
    "price": 5250,
    "created_at": "2016-09-06T19:09:49Z",
    "updated_at": "2016-09-06T19:09:49Z",
    "order_type": "PAYMENT",
    "merchant": "0010920335960001",
    "source_id": "4QeQD63ZeKsz",
    "items": [{
            "id": "0687f00a-0aea-48f7-85d0-64bc31977734",
            "sku": "0000001",
            "name": "Suco Detox",
            "unit_price": 800,
            "quantity": 1,
            "unit_of_measure": "EACH"
        },
        {
            "id": "cf561196-4e4c-436b-816b-80190e9a705f",
            "sku": "0000010",
            "name": "Suco de Uva",
            "unit_price": 450,
            "quantity": 5,
            "unit_of_measure": "EACH"
        },
        {
            "id": "16b4b10b-9967-477b-91a2-ecc02e6ff40c",
            "sku": "0000011",
            "name": "Suco de Tomate",
            "unit_price": 500,
            "quantity": 2,
            "unit_of_measure": "EACH"
        },
        {
            "id": "8500c747-1740-47cf-908a-3ab0f8b44193",
            "sku": "0000100",
            "name": "Suco de Abacaxi",
            "unit_price": 400,
            "quantity": 3,
            "unit_of_measure": "EACH"
        }
    ],
    "transactions": []
}
}
```

#### GET - Consultar todos os Pedidos

Esse recurso é utilizado para obter a lista e as informações de todos os pedidos cadastrados no Order Manager.

> Endpoint:
> 
> **GET** /orders/

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

Exemplo de requisição:

> **GET**  https://api.cielo.com.br/order-management/v1/orders/

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|order|Order|Informações sobre o pedido consultado.|Não|

Exemplo de resposta:

```json
{
    "id": "b4d8a7dc-4250-48a3-bf18-d560d4508368",
    "number": "0992f1d5-cee5-40d9-a964-8f4d6a9e4aa6",
    "reference": "LOJA SUCO #1",
    "status": "ENTERED",
    "notes": "Mesa 6",
    "price": 5250,
    "created_at": "2016-09-06T19:09:49Z",
    "updated_at": "2016-09-06T19:09:49Z",
    "order_type": "PAYMENT",
    "merchant": "0010920335960001",
    "source_id": "4QeQD63ZeKsz",
    "items": [{
            "id": "0687f00a-0aea-48f7-85d0-64bc31977734",
            "sku": "0000001",
            "name": "Suco Detox",
            "unit_price": 800,
            "quantity": 1,
            "unit_of_measure": "EACH"
        },
        {
            "id": "cf561196-4e4c-436b-816b-80190e9a705f",
            "sku": "0000010",

            "name": "Suco de Uva",
            "unit_price": 450,
            "quantity": 5,
            "unit_of_measure": "EACH"
        },
        {
            "id": "16b4b10b-9967-477b-91a2-ecc02e6ff40c",
            "sku": "0000011",
            "name": "Suco de Tomate",
            "unit_price": 500,
            "quantity": 2,
            "unit_of_measure": "EACH"
        },
        {
            "id": "8500c747-1740-47cf-908a-3ab0f8b44193",
            "sku": "0000100",
            "name": "Suco de Abacaxi",
            "unit_price": 400,
            "quantity": 3,
            "unit_of_measure": "EACH"
        }
    ],
    "transactions": []
}
```

#### PUT- Alterar status de um pedido

Esse recurso realiza a alteração do status de um pedido criado. O id do pedido é utilizado para realizar a chamada.

As possíveis alterações de status são:
* PLACE (Liberar um pedido para pagamento, exibir pedido na Cielo LIO)
* PAY (Alterar um pedido para pago)
* CLOSE (Fechar um pedido)

> Endpoint:
> 
> **PUT** /orders/<id>?operation=<operation>

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|
|operation|query parameter|Operação que deve ser executada. As possíveis operações são: place (Liberar um pedido para pagamento), pay (deixar um pedido como pago) e close (Fechar um pedido).|Sim|

Exemplo de requisição:

> **PUT**  https://api.cielo.com.br/order-management/v1/orders/db815e66-e5b6-497c-8444-2120cc87d33a?operation=PLACE

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

Exemplo de resposta:

```json
N/A
```

O retorno 200 dessa operação representa sucesso na requisição.

#### DELETE - Excluir um pedido

Esse recurso é utilizado para excluir um pedido do servidor do Order Manager. O id do pedido é utilizado para realizar a chamada.

> Somente os pedidos com status **DRAFT** podem ser excluídos.
>
> Endpoint:
> 
> **DELETE** /orders/<id>

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|

Exemplo de requisição:

> **DELETE** https://api.cielo.com.br/order-management/v1/orders/db815e66-e5b6-497c-8444-2120cc87d33a

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

Exemplo de resposta:

```json
N/A
```

O retorno 200 dessa operação representa sucesso na requisição.

#### POST - Adicionar Item/Itens em um Pedido

Esse recurso é utilizado para adicionar um ou mais itens em um pedido já criado. O id do pedido é utilizado para realizar a chamada.

> Somente os pedidos com status **DRAFT** podem ser excluídos.
>
> Endpoint:
> 
> **POST** /orders/<id>/items

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|

Exemplo de requisição:

```json
{
    "sku": "ede8f84a8b8645cb8e576a593c25c6ed",
    "name": "produto 1"
    "unit_price": 500,
    "quantity": 2,
    "unit_of_measure": "EACH"
}
```

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

Exemplo de resposta:

```json
N/A
```

O retorno 200 dessa operação representa sucesso na requisição.

#### GET - Consultar os itens de um pedido

Esse recurso é utilizado para consultar os itens presentes em um pedido. O id do pedido é utilizado para realizar a chamada.

> Endpoint:
> 
> **GET** /orders/<id>/items

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|

Exemplo de requisição:

> **GET** https://api.cielo.com.br/order-management/v1/orders/c393ce9f-3741-413f-8ad5-2f142eaed51f/items

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|orderItems|Lista (OrderItem)|Lista de itens de um pedido.|Sim|

Exemplo de resposta:

```json
[{
        "id": 1,
        "sku": "ede8f84a8b8645cb8e576a593c25c6ed",
        "name": "produto 1"
        "unit_price": 500,
        "quantity": 2,
        "unit_of_measure": "EACH"
    },
    {
        "id": 2,
        "sku": "c2f5fb9a5542406e8b7917892329cda8",
        "name": "produto 1"
        "unit_price": 1500,
        "quantity": 3,
        "unit_of_measure": "EACH"
    }
]
```

#### PUT - Alterar um item em um pedido

Esse recurso permite alterar informações de um item de um pedido. O id do pedido e o id_item são utilizados para realizar a chamada.

> Somente os pedidos com status **DRAFT** podem ter itens alterados.
> 
> Endpoint:
> 
> **PUT** /orders/<id>/items/<id_item>

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|
|id_item|path parameter|Identificador do item do pedido.|Sim|

Exemplo de requisição:

> **PUT** https://api.cielo.com.br/order-management/v1/orders/a9398720-9f78-4fa4-a5d4-ba54ba8009e7
/items/8484df74-eca6-4850-8e4c-35653af0bd31

```json
{
    "sku": "ede8f84a8b8645cb8e576a593c25c6ed",
    "unit_price": 500,
    "quantity": 2,
    "unit_of_measure": "EACH"
}
```

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

O retorno 200 dessa operação representa sucesso na requisição.

#### DELETE - Excluir Item de um pedido

Esse recurso é utilizado para excluir um item presente em um pedido. O id do pedido e o id_item são utilizados para realizar a chamada.

> Somente os pedidos com status **DRAFT** podem ter itens alterados.
> 
> Endpoint:
> 
> **DELETE** /orders/<id>/items/<id_item>

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|
|id_item|path parameter|Identificador do item do pedido.|Sim|

Exemplo de requisição:

> **DELETE** https://api.cielo.com.br/order-management/v1/orders/a9398720-9f78-4fa4-a5d4-ba54ba8009e7/items/8484df74-eca6-4850-8e4c-35653af0bd31

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|N/A||||

O retorno 200 dessa operação representa sucesso na requisição.

#### POST -  Adicionar uma Transação

> Recurso utilizado somente para **Ambiente de Sandbox**

Esse recurso permite que o desenvolvedor simule as transações financeiras, adicionando-as manualmente, sendo possível entender o funcionamento em uma Order.

> Endpoint:
> 
> **POST** /orders/<id>/transactions

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|Transactions|Lista (Transaction)|Informações da Transação|Sim|

Exemplo de requisição:

> **POST** https://api.cielo.com.br/order-management/v1/orders/a9398720-9f78-4fa4-a5d4-ba54ba8009e7/transactions

```json
{
    "transaction_type": "PAYMENT",
    "status": "CONFIRMED",
    "Terminal_number": "77102XXX",
    "card": {
        "brand": "VISA",
        "mask": "1234",
        "bin": "490172",
        "last": "7897"
    },
    "number": "1234589",
    "authorization_code": "22388292",
    "payment_product": {
        "number": 928282,
        "name": "CREDITO",
        "sub": {
            "number": 928282,
            "name": "A VISTA"
        }
    },
    "amount": 5151
}
``` 

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|number|Identificador da Transação|SIM|

```json
{
id: "00219dd0-1c13-46da-91e5-1c313f0d2e83"
}
```

Em ambiente de Sandbox, onde não há necessidade de ter uma Cielo LIO, e consequentemente não é necessário possuir o número do estabelecimento, faz total sentido fazer essa chamada deste recurso.

Já em ambiente de Produção quem irá criar as transactions é a própria Cielo LIO conforme os pagamentos forem efetuados.

#### GET -  Consultar as transações de um pedido

Esse recurso é utilizado para obter as informações de todas as transações realizadas em um pedido. O id do pedido é utilizado para realizar a chamada.
Em ambiente de produção, uma vez que um pagamento for realizado na Cielo LIO a transactions será adicionada automaticamente no pedido e então, será possível obter as informações do pagamento realizado a partir da chamada deste recurso.

> Endpoint:
> 
> **GET** /orders/<id>/transactions

Dados de entrada:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|id|path parameter|Identificador do pedido.|Sim|

Exemplo de requisição:

> **GET** https://api.cielo.com.br/order-management/v1/orders/c393ce9f-3741-413f-8ad5-2f142eaed51f/transactions

Dados de saída:

|Campo|Tipo|Descrição|Obrigatório|
|-----|----|---------|-----------|
|transactions|Lista (Transaction)|Lista de transações de um pedido.|SIM|

Exemplo de resposta:

```json
[{
    "id": "ede8f84a8b8645cb8e576a593c25c6ed",
    "external_id": "40578a65-939e-4613-b8c1-9e7358c6c256",
    "transaction_type": "PAYMENT",
    "status": "CONFIRMED",
    "terminal_number": "928273921",
    "card": {
        "brand": "VISA",
        "bin": "490172",
        "last": "7897"
    },
    "number": "1234589",
    "authorization_code": "22388292",
    "payment_product": {
        "number": 928282,
        "name": "CREDITO",
        "sub": {
            "number": 928282,
            "name": "A VISTA"
        }
    },

    "amount": 5000,
    "created_at": "20151020T13:13:29.000Z",
    "updated_at": "20151022T12:13:29.000Z"
}]
```

### Fluxo Básico Utilização API Order manager Cielo LIO

Abaixo você encontra um fluxo básico para enviar um pedido para a Cielo LIO utilizando a Integração Remota:

![fluxo_basico](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/fluxogram-order-manager-slim.png)

### Notificações de Mudanças na Order

O maior motivo da disponibilização da API RESTful do Order Manager é permitir que aplicações parceiras se integrem à plataforma da Cielo na cloud. Porém, uma vez que as aplicações parceiras submetem pedidos, estes devem ser pagos localmente na própria Cielo LIO. Sendo assim, as aplicações parceiras precisam de uma forma de receber notificações de mudanças do status e das transações realizadas na Order.

Para tal, é necessário que o parceiro disponibilize um Backend RESTful, que irá receber as notificações seguindo o formato abaixo. Uma vez recebidas as informações, o Backend tem a liberdade de ser utilizado da forma mais adequada ao modelo de negócio.

#### PUT - Notificação de Mudança de Status

A cada modificação de status em um pedido, o servidor do Order Manager envia, via comando, as informações para o Backend do parceiro.

Requisição do Order Manager

> **PUT** <url_cadastrada_pelo_parceiro>

Exemplo de informação enviada pelo Order Manager

```json
{
    "id": "f9a9e3c0d31445f7ac419642651f0a52",
    "order_id": "ede8f84a8b8645cb8e576a593c25c6ed",
    "type": "STATUS_CHANGED",
    "status": {
        "old": "ENTERED",
        "new_status": "PAID"
    }
}
```

#### PUT - Notificação de Transação Realizada

A cada transação/pagamento realizada em um pedido, o servidor do Order Manager envia, via comando, as informações para o Backend do parceiro.

Requisição do Order Manager

> **PUT** <url_cadastrada_pelo_parceiro>

Exemplo de informação enviada pelo Order Manager

```json
{
    "id": "c7b1dfc39f59436fbc55db8b4e360a96",
    "order_id": "ede8f84a8b8645cb8e576a593c25c6ed",
    "type": "TRANSACTION_ADDED",
    "transaction": {
        "id": "ede8f84a8b8645cb8e576a593c25c6ed",
        "transaction_type": "PAYMENT",
        "status": "CONFIRMED",
        "terminal_number": "928273921",
        "card": {
            "brand": "VISA",
            "bin": "490172",
            "last": "7897"
        },
        "number": "1234589",
        "authorization_code": "22388292",
        "payment_product": {
            "number": 928282,
            "name": "CREDITO",
            "sub": {
                "number": 928282,
                "name": "A VISTA"
            }
        },
        "amount": 5000,
        "created_at": "20151020T13:13:29.000Z",
        "updated_at": "20151022T12:13:29.000Z"
    }
}
}
```

## SDK

|||||
|---|---|---|---|
|[![android](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/01-sdk-android.png)](https://github.com/DeveloperCielo/LIO-SDK-API-Integracao-Remota-v1-Android)| [![C#](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/03-sdk-csharp.png)](https://github.com/DeveloperCielo/LIO-SDK-API-Integracao-Remota-v1-CSHARP)  | [![android](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/04-sdk-java.png)](https://github.com/DeveloperCielo/LIO-SDK-API-Integracao-Remota-v1-Java)  |  [![android](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/07-sdk-php.png)](https://github.com/DeveloperCielo/LIO-SDK-API-Integracao-Remota-v1-PHP) |

# Integração Local

## Apresentação

O objetivo da Integração Local da Cielo LIO é permitir que o aplicativo desenvolvido em Android se integre com o módulo de pedidos e pagamentos da Cielo LIO através do Cielo LIO Order Manager SDK.

Nesse modelo de integração, toda a gestão do estabelecimento comercial e da arquitetura da solução fica sob responsabilidade do aplicativo que irá utilizar o SDK nas operações de pagamento.

![modelo de integração](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/diagrama-apresentacao-images.png)

* O aplicativo do parceiro rodando na Cielo envia informações para o Cielo LIO Order Manager SDK.
* O Cielo LIO Order Manager SDK executa os fluxos para pagamento.
* O aplicativo do parceiro recebe as informações do pagamento e continua sua execução.

As seções abaixo possuem todas as informações necessárias para realizar a integração de forma rápida e segura.

---

## Vídeo Demo

No vídeo abaixo, é possível ver um exemplo de aplicativo integrado com o Cielo LIO Order Manager SDK, utilizando a função de pagamento de valores do SDK.

[![Vídeo Demo](https://img.youtube.com/vi/d7y-x6p36YU/0.jpg)](https://www.youtube.com/watch?v=d7y-x6p36YU)

Clique na imagem acima, para acessar o vídeo

## Code Sample

O código do exemplo do aplicativo integrado com o Cielo LIO Order Manager SDK encontra-se disponível no GitHub.

Fluxo para Integração

![fluxo para integração](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/fluxogram-local-new.png)

1. Leia toda a documentação sobre a Integração Local.
2. Crie sua conta no Portal de Desenvolvedores da Cielo para obter todas as funcionalidades que o portal pode oferecer para você, desenvolvedor. É obrigatório possuir uma conta para gerar um Client-Id.
3. Realizando o cadastro de Client ID, o desenvolvedor recebe os tokens
4. (Client ID e Access-Token) e consegue utilizar o Cielo LIO Order Manager SDK. Realize os testes no Emulador Cielo Lio Confira o link: [Download do Emulador](https://s3-sa-east-1.amazonaws.com/cielo-lio-store/apps/lio-emulator/1.0.0/lio-emulator.apk)
5. Acesse a [Cielo Store](https://www.cieloliostore.com.br/login) e faça o upload do APK da sua aplicação. Ao término do upload, submeta seu aplicativo para certificação e preencha todas as informações necessárias.
6. Ao término do upload submeta seu aplicativo, no próprio ambiente da Cielo Store, para certificação e preencha todas as informações necessárias.
7. Assim que a certificação for concluída, o desenvolvedor receberá um e-mail e deverá acessar novamente a Cielo Store para promover o aplicativo para produção.
8. Agora seu aplicativo já está disponível para download na Cielo Store. Sucesso!! Aproveite ao máximo tudo que a Integração Local Cielo LIO pode oferecer para você!!

## Cielo Lio Order Manager SDK

### Sobre

O Cielo LIO Order Manager SDK é uma biblioteca Android desenvolvida com base na Cielo LIO Order Manager API, encapsulando a complexidade da comunicação REST em uma API fluente e amigável ao desenvolvedor e permitindo uma integração simples, rápida e segura com a plataforma Cielo LIO.

O principal objetivo do Cielo LIO Order Manager SDK é simplificar a integração com o sistema de pagamentos e permitir que o desenvolvedor concentre esforços no desenvolvimento das características do seu aplicativo. Abaixo, é apresentado um exemplo em alto nível do processo de utilização do Cielo LIO Order Manager SDK por um aplicativo parceiro:

![fluxo](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/sdk-order.jpg)

1. O aplicativo do parceiro é responsável por gerenciar todas as informações do pedido e, então, enviá-las para o Cielo LIO Order Manager SDK.
2. O Cielo LIO Order Manager SDK recebe as informações e o fluxo de pagamento para o cliente. Neste fluxo, o cliente irá selecionar a forma de pagamento e digitar a senha no Pinpad, tendo a possibilidade de enviar por e-mail o comprovante do pagamento.
3. Ao término do fluxo de pagamento, o aplicativo do parceiro recebe as informações sobre o pagamento realizado e volta a ser executado na tela da Cielo LIO.

> **Atenção:** Para utilizar o Cielo LIO Order Manager SDK, é necessário possuir um aplicativo desenvolvido em Android.

Para mais informações e detalhes sobre o desenvolvimento de um aplicativo para a Cielo LIO, acesse a documentação Desenvolva um App para LIO.

### Ambiente Sandbox - Emulador

A Cielo disponibiliza um aplicativo que simula o ambiente da Cielo LIO em qualquer dispositivo Android, permitindo que o desenvolvedor realize os testes nos métodos do SDK e faça o debug da sua aplicação durante o desenvolvimento e a integração com o Cielo LIO Order Manager SDK, sem a necessidade de possuir um hardware da Cielo LIO.

Faça o download do emulador no link abaixo:

[Download do Emulador](https://s3-sa-east-1.amazonaws.com/cielo-lio-store/apps/lio-emulator/1.0.0/lio-emulator.apk)

Para instalar o aplicativo, basta seguir os seguintes passos:

* Acesse as configurações do seu aparelho e vá até o menu “Segurança”;
* Localize o item “Fontes desconhecidas”, na seção “Administração do dispositivo”
* Toque na chave ao lado e confirme sua escolha para passar a permitir a instalação de arquivos APK baixados por fontes alternativas.

### Configurar módulos e dependências

Após configurar um novo projeto no Android Studio, é necessário incluir a dependência abaixo no projeto.

Para a versão release, adicione o módulo do Cielo LIO Order Manager SDK nas dependências do Gradle:

> compile 'com.cielo.lio:order-manager:0.15.0'

### Credenciais

Para utilizar o Cielo LIO Order Manager SDK, é necessário inserir as seguintes credenciais na inicialização do OrderManager:

```json
    // Criação das credenciais. Não se esquecer de substituir
    // Client-Id e Access-Token por suas credenciais. 
    
    Credentials credentials = new Credentials("Client-Id", "Access-Token"); 
    
    orderManager = new OrderManager(credentials, context);
```

* Client-Id
Identificação de acesso. Sua geração ocorre no momento da criação pelo painel do desenvolvedor. Seu valor pode ser visualizado na coluna Client ID, dentro do menu 'Desenvolvedor' -> 'Client ID Cadastrados'.
* Access-Token
Identificação do token de acesso, que armazena as regras de acesso permitidas ao Client ID. Sua geração ocorre no momento da criação do Client ID pelo painel do desenvolvedor. Seu valor pode ser visualizado clicando em 'detalhes' na coluna 'Access Tokens', dentro do menu 'Desenvolvedor' -> 'Client ID Cadastrados'.

### Release Notes

Na tabela abaixo, é possível verificar as funcionalidades do SDK disponíveis por versão da Cielo LIO e Cielo Mobile.

| Funcionalidade                                                                                                                                                                                                           | Versão Cielo LIO | Versão Cielo Mobile |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|---------------------|
| createDraftOrder(String reference)placeOrder(Order order)updateOrder(Order order)checkoutOrder(String orderId, PaymentListener paymentListener)checkoutOrder(String orderId,long value, PaymentListener paymentListener) | 1.10.2           | 1.9.1               |
| retrievePaymentType()checkoutOrder(String orderId,long value, String primaryCode, String secondaryCode, PaymentListener,paymentListener)                                                                                 | 1.12.0           | 1.10.3              |
| retrieveOrders(int pageSize, int page)                                                                                                                                                                                   | 1.13.0           | 1.10.5              |
| checkoutOrder (String orderId,long value, String primaryCode, String secondaryCode, Long installments, PaymentListener paymentListener)                                                                                  | 1.14.0           | 1.12.1              |
| cancelOrder (Context context, String orderId, Payment payment, CancellationListener paymentListener)cancelOrder (Context context, String orderId, Payment payment, Long amount, CancellationListener paymentListener)    | 1.16.7           | 1.12.10             |

>**Atenção:** Se for utilizada uma funcionalidade que não esteja disponível, será lançada uma exceção – UnsupportedOperationExcepetion –, que deve ser tratada pelo aplicativo.

Para descobrir a versão do aplicativo Cielo LIO (versão do Launcher) e Cielo Mobile, bem como utilizar todas as funcionalidades do Cielo LIO Order Manager SDK, acesse “Sobre a Cielo LIO” (Ajuda -> Sobre a Cielo LIO) para obter as informações sobre os aplicativos instalados na Cielo LIO.

## Utilização Cielo LIO Order Manager SDK

O fluxo básico para utilização do SDK pode ser dividido em 7 etapas, conforme o diagrama abaixo:

![order manager sdk fluxo](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/fluxogram-lio-sdk.png)

Abaixo, iremos mostrar como realizar cada uma dessas etapas.

### Criar OrderManager

Este método permite iniciar o OrderManager, que é responsável pelas principais operações do Cielo LIO Order Manager SDK. O OrderManager representa a interface com a API REST do Order Manager.

Tudo começa com a criação do OrderManager!

```json
orderManager = new OrderManager(credentials, context);
```

O construtor do OrderManager recebe 2 parâmetros:

| Atributo    | Descrição                                                                                                                                                                                                                                                                                              | Domínio                     |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
| credentials | Credenciais de acesso do Parceiro/Desenvolvedor. Depois de se registrar no Portal de Desenvolvedores e criar seu app, o Parceiro/Desenvolvedor recebe as credenciais (Client-Id e Access-Token). Elas servem para identificá-lo unicamente na plataforma LIO e diferenciar as ordens da sua aplicação. | cielo.sdk.order.Credentials |
| context     | O contexto da aplicação                                                                                                                                                                                                                                                                                | android.content.Context     |

>**Atenção:** Recomendamos criar/inicializar o OrderManager no aplicativo do parceiro no momento em que for utilizar as funcionalidades, visando otimizar o desempenho do aplicativo

### Vincular o contexto da aplicação ao SDK

Com este método – Bind –, é possível vincular o contexto da aplicação ao SDK. Este serviço é responsável por gerenciar as funções relacionadas com as ordens da LIO

```json
    ServiceBindListener serviceBindListener = new ServiceBindListener() {
        @Override
        public void onServiceBound() {
                // O serviço está vinculado 
        } 
    
        @Override
        public void onServiceUnbound() {
                // O serviço foi desvinculado
        }
    }; 
    orderManager.bind(contextActivity, serviceBindListener);
```

O método Bind recebe dois parâmetros:

* **contextActivity:** Activity que proverá o contexto a que o serviço será vinculado.

* **serviceBindListener:** Listener que notifica se o serviço foi vinculado ou não.

Com o OrderManager inicializado e após a execução do método onServiceBound, se torna possível ir para a próxima etapa e criar um pedido (classe Order).

### Criar um pedido

A Cielo LIO trabalha com o conceito de Order (pedido). É necessário possuir um pedido para então realizar o(s) pagamento(s).

Este método permite criar uma Order (classe Order). Para realizar essa criação, utilize o método createDraftOrder, que disponibilizará uma Order com status DRAFT:

```json
Order order = orderManager.createDraftOrder("REFERÊNCIA_DO_PEDIDO");
```

### Adicionar itens em um pedido

Este método permite que sejam adicionados itens em um pedido.

> **Atenção:** É necessário adicionar no mínimo um item a um pedido para que seja possível dar continuidade ao pagamento.

```json
    // Identificação do produto (Stock Keeping Unit)
    String sku = "2891820317391823";
    String name = "Coca-cola lata";
    
    // Preço unitário em centavos
    int unitPrice = 550;
    int quantity = 3;
    
    // Unidade de medida do produto String
    unityOfMeasure = "UNIDADE";
    
    order.addItem(sku, name, unitPrice, quantity, unityOfMeasure);
```

### Liberar pedido para pagamento

Este método permite atualizar o status de um pedido e liberá-lo para pagamento. O objetivo é utilizar este método depois de adicionar todos os itens no pedido.

```json
orderManager.placeOrder(order);
```

Após a execução desse método, o status da Order irá trocar de DRAFT para ENTERED, permitindo que a mesma seja paga.

> **Atenção:** É importante observar que, uma vez que uma Order tenha mudado de status para ENTERED, não será mais possível incluir itens na mesma.
Iniciar processo de pagamento

Este método permite iniciar o processo de pagamento na Cielo LIO.

```java
    PaymentListener paymentListener = new PaymentListener() {
                @Override
                public void onStart() {
                Log.d("MinhaApp", "O pagamento começou.");
                }
                
                @Override
                public void onPayment(@NotNull Order order) {
                Log.d("MinhaApp", "Um pagamento foi realizado.");
                } 
                
                @Override public void onCancel() {
                Log.d("MinhaApp", "A operação foi cancelada.");
                } 
                
                @Override public void onError(@NotNull PaymentError paymentError) {
                Log.d("MinhaApp", "Houve um erro no pagamento.");
                }
    }; 
    
    String orderId = order.getId();
    
    long value = order.getPrice();
    
    orderManager.checkoutOrder(orderId, value, paymentListener);
```

## Processo de Pagamento

Existem 4 formas diferentes de chamar o método checkoutOrder:

![checkoutorder formas](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/checkoutOrder.jpg)

### 1. Pagamento Parcial

No Pagamento parcial, o valor do pagamento é informado dentro do fluxo de telas da Cielo LIO. Na sequência, o fluxo de pagamento da Cielo LIO é iniciado (inserir o cartão, digitar a senha e visualizar e/ou enviar por e-mail o comprovante).

Nessa forma de pagamento, é necessário apenas fazer a chamada do método enviando os seguintes parâmetros:

| Atributo        | Descrição                                                                                                                                                                                                                                                                                                                                                                                                | Domínio                                 |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
| orderId         | O identificador do pedido a ser pago.                                                                                                                                                                                                                                                                                                                                                                    | String                                  |
| paymentListener | Um callback que informa sobre todas as ações tomadas durante o processo de pagamento.   As seguintes ações podem ser notificadas:  * onStart - Quando se dá o início do pagamento. * onPayment - Quando um pagamento é realizado. Notem que um pedido pode ser pago por mais de um * pagamento. * onCancel - Quando o pagamento é cancelado. * onError - Quando acontece um erro no pagamento do pedido. | cielo.sdk.order.payment.PaymentListener |

**Fluxo da transação utilizando o pagamento parcial da Cielo LIO**

Abaixo, segue um exemplo do fluxo com as telas exibidas durante o pagamento parcial:

![fluxo parcial](https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/pagamento-parcial.jpg)
