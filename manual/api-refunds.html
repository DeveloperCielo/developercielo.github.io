<!DOCTYPE html>
<html lang="pt">
    <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="theme-color" content="#00aeef" />
  <meta http-equiv="Content-Language" content="pt" />

  <!-- Enable responsiveness on mobile devices-->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />

  <title>
     API Refunds &middot; Documentações e tutoriais 
  </title>

  <link rel="shortcut icon" href="https://developercielo.github.io/assets/favicon.ico" />

  <!-- CSS -->
  <link
    href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,500"
    rel="stylesheet"
    media="none"
    onload="if(media!='all')media='all'"
  />
  <script async src="https://use.fontawesome.com/3ae06f1030.js"></script>

  <link
    rel="stylesheet"
    href="https://developercielo.github.io/assets/bundles/css/bundle.min.css"
  />

   
  <link
    rel="alternate"
    hreflang="pt"
    href="https://developercielo.github.io/manual/api-refunds"
  />
    
  <link
    rel="alternate"
    hreflang="en"
    href="https://developercielo.github.io/en/manual/api-refunds"
  />
   

  <!-- RSS -->
  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS"
    href="https://developercielo.github.io/atom.xml"
  />
</head>

    <body>
        
        <div class="content-container">
            <div class="language-tabs">
                <a class='hide-btn' id="hide-button" title="Comutar"><i class="fa fa-bars" aria-hidden="true"></i></a>
                <ul class="language-buttons">
                    
                    <li><a data-language-name='json'>JSON</a></li>
                    
                </ul>
            </div>
            <div class="dark-box"></div>
            <div class="overlay"></div>
        
            <div id="submenu">
                <div class="submenu-container">
                    <div class="submenu-row sub-items">
                        <div class="submenu-itens">
                            <a href="https://devcielo.zendesk.com/hc/pt-br#suporte" class="help">Ajuda</a>

                            
                        </div>

                        
                        <div class="search">
                            <input type="text" class="search" id="input-search">
                        </div>
                    </div>
                    <div class="submenu-row results">
                        <div class="search-results-container">
                            <ul class="search-results"></ul>
                        </div>
                    </div>
                        

                    <div class="submenu-row breads">
                        <ol class="breadcrumb">
                            
                            <li><a href="/">Início</a></li>
                            
                            
                            
                            
                                
                                    
                                    
                                    
                                    
                                    
                                        
                                    
                                        
                                    
                                        
                                    
                                
                            
                                
                                    
                                    <li class="active">&gt; <a href="https://developercielo.github.io/manual/api-refunds">API Refunds</a></li>
                                    
                                
                            
                        </ol>
                    </div>
                </div>
            </div>

            <div class="post"><h1 id="objetivo">Objetivo</h1>

<p>O objetivo desta documentação é orientar sobre a integração com a API Única de Cancelamento de vendas Cielo, descrevendo funcionalidade, informações técnicas e etapas para solicitação de acesso.</p>

<h1 id="sobre-a-api-Única-de-cancelamento">Sobre a API Única de Cancelamento</h1>

<p>A API Única de Cancelamento é mais uma opção de canal de cancelamento de vendas disponibilizado pela Cielo aos clientes.</p>

<p>Com a API Única de cancelamento, é possível centralizar cancelamentos de vendas de diversas soluções de captura em uma única integração (POS, LIO, TEF e E-commerce) além de permitir consulta de cancelamentos e geração de Cartas de Cancelamentos efetivados.</p>

<p>A integração com a API exige credenciais de acesso que são concedidas por Raiz de CNPJ. Ou seja, todos os Estabelecimentos (ECs) que fazem parte dessa raiz podem ter cancelamentos de vendas solicitados usando uma mesma credencial de acesso em uma única integração.</p>

<p>Principais benefícios da solução da API de Cancelamento</p>
<ul>
  <li><strong>Solicitação de cancelamento direta</strong> para o Sistema de Cancelamento Cielo.</li>
  <li><strong>Consulta de Status de Cancelamento</strong> com descrição complementar de motivo em caso de rejeição de cancelamento.</li>
  <li><strong>Centralização de solicitações de cancelamento</strong> de vendas feitas por variadas soluções de captura usadas pelo cliente (POS, TEF, LIO, E-commerce).</li>
  <li><strong>Geração de Carta de Cancelamento</strong> no mesmo dia da efetivação do cancelamento, de forma unitária ou em lote.</li>
  <li><strong>Autonomia e autosserviço</strong> no processo de solicitação de cancelamento de vendas.</li>
  <li><strong>Simplicidade</strong>: o protocolo utilizado é puramente HTTPS, tecnologia REST, que é padrão de mercado.</li>
  <li><strong>Facilidade de testes</strong>: disponibilizamos credenciais de ambiente de homologação e massa de vendas para teste em ambiente de homologação.</li>
</ul>

<h1 id="produtos-e-bandeiras-suportadas">Produtos e Bandeiras suportadas</h1>

<p>A versão atual da API Cancelamento Cielo possui <strong>suporte de cancelamento</strong> a <strong>todos os produtos e bandeiras</strong> capturados pela Cielo com <strong>exceção de PIX</strong>, transações de <strong>Voucher</strong> e Pré-autorização.</p>

<h1 id="fluxo-para-acesso-api-de-cancelamento">Fluxo para acesso API de Cancelamento</h1>

<p>O fluxo abaixo mostra  a integração do cliente na API Única de Cancelamento desde o recebimento das credenciais de Homologação produção até o acesso à API em Produção</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/cancelamento/Imagem1.jpg" alt="Imagem1" /></p>

<h1 id="solicitação-de-credenciais-para-produção-client_id-e-client_secret">Solicitação de Credenciais para Produção (client_id e client_secret)</h1>

<h2 id="envio-de-informações-para-solicitação-de-credencial">Envio de informações para solicitação de credencial</h2>

<p>Para obter acesso à API de Cancelamento em Produção, envie os dados abaixo para: <strong>api.cancelamento@cielo.com.br</strong></p>

<ul>
  <li><strong>Nome</strong>: nome do ponto focal do estabelecimento que fará o gerenciamento das credenciais para acessar a API de Cancelamento.</li>
  <li><strong>E-mail</strong>: e-mail do ponto focal do estabelecimento que fará o gerenciamento das credenciais para acessar a API de Cancelamento.</li>
  <li><strong>Raiz de CNPJ</strong>: raiz do CNPJ que deseja integrar na API. Caso tenha mais de uma raiz de CNPJ a ser integrada, envie todas.</li>
</ul>

<blockquote>
  <p><strong>Nota</strong>: Todos os estabelecimentos que compõem essa raiz de CNPJ poderão ter os cancelamentos de vendas solicitados pela API Única de Cancelamento.</p>
</blockquote>

<p>Com esses dados, nosso time Cielo vai solicitar criação de credenciais de acesso para integração em Produção.</p>

<p>Mesmo que a integração do Estabelecimento com a API seja feita através de um terceiro, o e-mail que deve ser enviado deve ser do ponto focal do estabelecimento.</p>

<h2 id="cadastro-no-portal-de-desenvolvedores-cielo">Cadastro no Portal de Desenvolvedores Cielo </h2>

<p>Após a aprovação da solicitação, um e-mail será enviado ao ponto focal estabelecimento solicitante. </p>

<p>Acesse o Portal de Desenvolvedores Cielo  https://desenvolvedores.cielo.com.br/api-portal/ e realize seu cadastro.</p>

<blockquote>
  <p><strong>Importante:</strong> O cadastro deve ser realizado com o mesmo e-mail do ponto focal do Estabelecimento enviado no passo 1.</p>
</blockquote>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/cancelamento/Imagem2.png" alt="Imagem2" /></p>

<p>Preencha o e-mail de quem fará o gerenciamento das credenciais para acessar a API de cancelamento e demais dados do Estabelecimento.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem3_0.png" alt="Imagem3" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem4.png" alt="Imagem4" /></p>

<p>Ao concluir o cadastro, um e-mail de confirmação será enviado.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem5.png" alt="Imagem5" /></p>

<p>Acesse o e-mail utilizado no cadastro e acesse o link para validar o primeiro acesso.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem6.png" alt="Imagem6" /></p>

<p>Altere a senha inicial e salve as alterações.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem7.png" alt="Imagem7" /></p>

<p>Para ter mais segurança no acesso às credenciais, clique no botão “Configurar Aplicativo” e instale em seu dispositivo móvel ou desktop aplicativo de duplo fator de autenticação que desejar /preferir.</p>
<ul>
  <li>Google Authenticator (Android/iPhone/BlackBerry)</li>
  <li>Authy (Android/iPhone)</li>
  <li>Authenticator (Windows Phone)</li>
  <li>FreeOTP (Android)</li>
  <li>GAuth Authenticator (Firefox OS, desktop, outros)</li>
</ul>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem8.png" alt="Imagem8" /></p>

<p>O aplicativo de autenticação de dois fatores será usado durante esta configuração e para gerar códigos durante a autenticação regular. Se o aplicativo for compatível, realize a leitura do código QR Code para obter o código de configuração, caso contrário você poderá inserir manualmente o código de texto.</p>

<p>Link para instalação do app: https://www.microsoft.com/pt-br/security/mobile-authenticator-app</p>

<p>Forneça a senha atual e confirme.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem9.png" alt="Imagem9" /></p>

<p>O aplicativo de autenticação de dois fatores será usado durante esta configuração e para gerar códigos durante a autenticação regular. Se o aplicativo for compatível, realize a leitura do código QR Code para obter o código de configuração, caso contrário você poderá inserir manualmente o código de texto.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem10.png" alt="Imagem10" /></p>

<p>Valide o código fornecido no aplicativo Microsoft Authenticator (é obrigatório).</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem11.png" alt="Imagem11" /></p>

<p>Após concluída a autenticação, a mensagem “Configuração do TFA concluída” será exibida e poderá ter acesso a sua conta conforme dados enviados por e-mail.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem12.png" alt="Imagem12" /></p>

<p>Acesse Cliente-Ids Cadastrados acessando no menu item <em>“Perfil” &gt; “Client-Ids Cadastrados”</em> ou acessando <em>Client-Ids Cadastrados</em> no rodapé.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem13.png" alt="Imagem13" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem14.png" alt="Imagem14" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem15.png" alt="Imagem15" /></p>

<h1 id="criação-de-uma-chave-pública-e-privada-para-criptografia-certificado-mtls">Criação de uma chave pública e privada para criptografia (Certificado MTLS)</h1>

<p>Para conferir maior segurança no uso da API Única de Cancelamento, é necessário uso de certificado assinado pela Cielo.</p>

<p>Este certificado não tem custo adicional e todas as chamadas aos serviços da API em homologação e produção devem ser feitas com certificado MTLS assinado pela Cielo.</p>

<p>Gere o arquivo da chave pública no formato .csr executando o comando abaixo em um terminal como gitbash ou via ferramenta openssl.</p>

<p>Exemplo:</p>

<blockquote>
  <p>openssl req -new -newkey rsa:2048 -nodes -keyout <strong>NomeEmpresa</strong>_Cielo.key -out <strong>NomeEmpresa</strong>_Cielo.csr</p>
</blockquote>

<p>Ao executar este comando, preencha as informações solicitadas conforme exemplo abaixo e substituindo os dados sinalizadas na cor <strong>azul em negrito</strong> com o nome da sua empresa:</p>

<table>
  <thead>
    <tr>
      <th>Campo</th>
      <th>Descrição</th>
      <th>Valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">emailAddress</code></td>
      <td>E-mail da área de produtos Cielo responsável pela API</td>
      <td>api.cancelamento@cielo.com.br</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Common Name</code></td>
      <td>Nome da empresa que está integrando na API Única de Cancelamento</td>
      <td><strong>Informe nome da sua empresa</strong></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Organizational Unit</code></td>
      <td>Nome da área de produtos Cielo responsável pela API “squad-cancelamento”</td>
      <td>squad-cancelamento</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Organization Name</code></td>
      <td>Empresa que está fornecendo a solução API Única de Cancelamento</td>
      <td>Cielo S.A.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Locality</code></td>
      <td>Cidade Cielo</td>
      <td>Barueri</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">State</code></td>
      <td>Estado Cielo</td>
      <td>SP</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Country</code></td>
      <td>País Cielo</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>

<p><strong>Exemplo:</strong></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem16.png" alt="Imagem16" /></p>

<p>Serão gerados dois arquivos no caminho de diretório em que for executado o comando, um deles .csr e outr .key</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem17.png" alt="Imagem17" /></p>

<ul>
  <li>O arquivo “.key” é de uso exclusivo do estabelecimento</li>
  <li>Já o arquivo “.csr” deve ser encaminhado para assinatura da Cielo, sendo utilizado o mesmo certificado nos ambientes de Sandbox e Produção.</li>
</ul>

<p>O cliente deve enviar o arquivo .csr por e-mail para geração do certificado assinado.</p>

<p>Envie o arquivo para: <strong>api.cancelamento@cielo.com.br</strong> e aguarde retorno do time Cielo com o certificado MTLS assinado.</p>

<aside class="notice"> Após concluir o processo de assinatura do certificado MTLS e obter seu Client_ID e Client_Secret, você estará habilitado a acessar nosso ambiente de homologação e produção. 🚀🚀</aside>

<aside class="warning">Todas as chamadas para nossas APIs (nos ambientes de homologação ou produção) devem ser enviadas com a chave MTLS assinada. </aside>

<h1 id="configurações-para-utilização-da-api">Configurações para utilização da API</h1>

<h2 id="adicionar-certificado-mtls-no-postman">Adicionar certificado MTLS no Postman</h2>

<p>Nesse tópico serão fornecidas informações sobre como anexar o certificado assinado pela Cielo na API Única de Cancelamentos.</p>

<p>Na ferramenta do Postman, vá para o ícone de <em>“ferramentas” &gt; Configurações &gt; Certificados &gt; Anexe o arquivo .crt assinado pela Cielo e o .key.</em></p>

<p><strong>Observação:</strong> Este passo deve ser feito tanto para o ambiente de produção quanto para o de homologação, mas você pode usar o mesmo certificado, apenas alterando o campo “Host”.</p>

<p>Acesso aos endpoints da Cielo:</p>

<p>Homologação: 	https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds</p>

<p>Produção: 	  https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem18.png" alt="Imagem18" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem19.png" alt="Imagem19" /></p>

<h1 id="fluxo-de-autenticação-de-credenciais-do-cliente-client-credencials-flow">Fluxo de Autenticação de Credenciais do Cliente (Client Credencials flow)</h1>

<h2 id="obtenção-do-token">Obtenção do Token</h2>

<p>Para realizar uma solicitação de cancelamento ou consulta na API, é necessário obter o token utilizando seu cliente_id e Cliente_secret</p>

<p><strong>Homologação</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --location --request POST
https://apihml-corp.cielo.com.br/cielo-security-sys-hml/oauth/v2/MulesoftHML/protocol/openid-connect/token\

--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'client\_id={ **clientId** }' \
--data-urlencode 'client\_secret={ **secret** }' \
--data-urlencode 'grant\_type=client\_credentials'
</code></pre></div></div>

<p><strong>Produção</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --location --request POST
https://api-corp.cielo.com.br/cielo-security-sys-web/oauth/v2/MulesoftPRD/protocol/openid-connect/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'client\_id={ **clientId** }' \
--data-urlencode 'client\_secret={ **secret** }' \
--data-urlencode 'grant\_type=client\_credentials'
</code></pre></div></div>

<p><strong>Exemplo no Postman:</strong></p>

<p>Header:</p>

<aside class="notice">https://apihml-corp.cielo.com.br/cielo-security-sys-hml/oauth/v2/MulesoftHML/protocol/openid-connect/token</aside>

<p><strong>Body:</strong></p>

<p>(enviar o client_id e o client secret disponibilizado pela Cielo)</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem20.png" alt="Imagem20" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem21.png" alt="Imagem21" /></p>

<h2 id="enviando-uma-requisição-com-token">Enviando uma requisição com token</h2>

<p>Extraia o campo access_token do retorno da requisição apresentada no passo anterior e passe como header em “Authorization” quando for realizar requisição.</p>

<p>Exemplo: header (“Authorization”, “Bearer “ + token)</p>

<aside class="warning">Lembrete: O access_token precisa ser renovado a cada 5 minutos.</aside>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds</td>
    </tr>
  </tbody>
</table>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem22.png" alt="Imagem22" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem23.png" alt="Imagem23" /></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem24.png" alt="Imagem24" /></p>

<h1 id="serviços-disponíveis-api-Única-de-cancelamento">Serviços disponíveis API Única de Cancelamento</h1>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>DESCRIÇÃO</th>
      <th>PATH</th>
      <th>MÉTODO HTTP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Solicitação de Cancelamento (Unitária)</strong></td>
      <td>/v1/refunds</td>
      <td>POST</td>
    </tr>
    <tr>
      <td><strong>Solicitação de Cancelamento (Lote)</strong></td>
      <td>/v1/refunds</td>
      <td>POST</td>
    </tr>
    <tr>
      <td><strong>Consulta de Cancelamento (Unitária)</strong></td>
      <td>/v1/refunds/{refundID}/{merchantID}</td>
      <td>GET</td>
    </tr>
    <tr>
      <td><strong>Consulta de Cancelamento (Lista)</strong></td>
      <td>/v1/refunds?cancelStartDate={Data inicial}&amp;cancelEndDate={Data final}&amp;rows={linha}&amp;page={pagina}&amp;merchantId={merchantID}&amp;authorizationCode={código de autorização}</td>
      <td>GET</td>
    </tr>
    <tr>
      <td><strong>Geração de Carta de Cancelamento (Unitária)</strong></td>
      <td>/v1/refunds/v1/letter-api/pdf</td>
      <td>POST</td>
    </tr>
    <tr>
      <td><strong>Geração de Carta de Cancelamento (Lote)</strong></td>
      <td>/v1/refunds/v1/letter-api/zip</td>
      <td>POST</td>
    </tr>
  </tbody>
</table>

<h1 id="solicitação-de-cancelamento">Solicitação de Cancelamento</h1>

<p>Com esse serviço, é possível realizar solicitações de cancelamento individuais ou em lote através de dados da venda como número do EC, data da venda, código de autorização, valor da venda, entre outros.</p>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds</td>
    </tr>
  </tbody>
</table>

<p><strong>Headers:</strong></p>

<p>No campo “key” digite: Authorization e no campo “value” digite: Bearer + espaço + {access_token}</p>

<p>Em seguida no campo “key digite: Content-Type e no campo “value” digite: application/json.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem25.png" alt="Imagem25" /></p>

<p><strong>Corpo da Requisição (Body):</strong></p>

<p>Enviando uma solicitação de cancelamento.</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem26.png" alt="Imagem26" /></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">transactionID</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">identificador</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">transação</span><span class="w"> </span><span class="err">E-commerce.</span><span class="w">
</span><span class="err">Nsu</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Número</span><span class="w"> </span><span class="err">sequencial</span><span class="w"> </span><span class="err">único</span><span class="w">
</span><span class="err">cardNumberLast</span><span class="mi">4</span><span class="err">Digits</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">os</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">últimos</span><span class="w"> </span><span class="err">dígitos</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cartão</span><span class="w">
</span><span class="err">merchantID*</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">número</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">EC</span><span class="w"> </span><span class="err">(estabelecimento</span><span class="w"> </span><span class="err">comercial)</span><span class="w">
</span><span class="err">authorizationCode*</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Código</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">autorização</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w">
</span><span class="err">refundAmount:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">currency*=</span><span class="w"> </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">BRL</span><span class="w">
        </span><span class="err">value*=</span><span class="w"> </span><span class="err">Valor</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelar</span><span class="p">,</span><span class="w"> </span><span class="err">pode</span><span class="w"> </span><span class="err">ser</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">valor</span><span class="w"> </span><span class="err">parcial</span><span class="w"> </span><span class="err">ou</span><span class="w"> </span><span class="err">total.</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="err">saleAmount:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">currency*=</span><span class="w"> </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">BRL.</span><span class="w"> 
        </span><span class="err">value*=</span><span class="w"> </span><span class="err">valor</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w"> 
      </span><span class="p">}</span><span class="w">
</span><span class="err">transactionDate*</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">passar</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">formato</span><span class="w"> </span><span class="err">DD-MM-YYYY</span><span class="w"> </span><span class="err">HH</span><span class="mi">24</span><span class="err">:MI:SS</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w"> </span><span class="err">(Não</span><span class="w"> </span><span class="err">é</span><span class="w"> </span><span class="err">necessário</span><span class="w"> </span><span class="err">passar</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">hora</span><span class="w"> </span><span class="err">exata</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda)</span><span class="w">
</span></code></pre></div></div>

<p><em>*Campos obrigatórios</em></p>

<p><strong>Response da requisição de cancelamento</strong></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem27.png" alt="Imagem27" /></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="nl">"merchantID"</span><span class="p">:</span><span class="w"> </span><span class="err">número</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">EC</span><span class="w"> </span><span class="err">(estabelecimento</span><span class="w"> </span><span class="err">comercial)</span><span class="w">
      </span><span class="nl">"authorizationCode"</span><span class="p">:</span><span class="w"> </span><span class="err">Código</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">autorização</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w">
      </span><span class="nl">"refundAmount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"currency"</span><span class="p">:</span><span class="w">  </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">BRL.</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="err">Valor</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelar</span><span class="p">,</span><span class="w"> </span><span class="err">pode</span><span class="w"> </span><span class="err">ser</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">valor</span><span class="w"> </span><span class="err">parcial</span><span class="w"> </span><span class="err">ou</span><span class="w"> </span><span class="err">total</span><span class="w">
      </span><span class="p">}</span><span class="err">,</span><span class="w">
      </span><span class="nl">"saleAmount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"currency"</span><span class="p">:</span><span class="w">  </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">BRL.</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="err">Valor</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w">
      </span><span class="p">}</span><span class="err">,</span><span class="w">
      </span><span class="nl">"transactionDate"</span><span class="p">:</span><span class="w"> </span><span class="err">formato</span><span class="w"> </span><span class="err">DD-MM-YYYY</span><span class="w"> </span><span class="err">HH</span><span class="mi">24</span><span class="err">:MI:SS</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda</span><span class="w">
      </span><span class="nl">"controlID"</span><span class="p">:</span><span class="w"> </span><span class="err">identificador</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="err">Status</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">solicitação</span><span class="w"> 
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="err">,</span><span class="w">
  </span><span class="nl">"refundID"</span><span class="p">:</span><span class="w"> </span><span class="err">Identificador</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">lote</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
  </span><span class="nl">"refundDate"</span><span class="p">:</span><span class="w"> </span><span class="err">Data</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">solicitação</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cancelamento,</span><span class="w"> </span><span class="err">formato</span><span class="w"> </span><span class="err">exemplo:</span><span class="w"> </span><span class="mi">2019-12-27</span><span class="err">T</span><span class="mi">19</span><span class="err">:</span><span class="mi">38</span><span class="err">:</span><span class="mf">30.547</span><span class="err">Z</span><span class="w">
</span></code></pre></div></div>

<h1 id="consultar-cancelamento">Consultar Cancelamento</h1>

<p>Neste serviço, é possível consultar solicitações de cancelamento e visualizar status de cada requisição através de diversos parâmetros como lote de cancelamento, ID de cancelamento, data ou status.</p>

<p><strong>Headers</strong>: <strong>(*mesmos headers utilizados na requisição de cancelamento)</strong></p>

<p>No campo <strong>“key”</strong> digite: <strong>Authorization</strong> e no campo <strong>“value”</strong> digite: <strong>Bearer + espaço + {access_token}</strong>
Em seguida no campo <strong>“key</strong> digite: Content-Type e no campo <strong>“value”</strong> digite: <strong>application/json.</strong></p>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>MÉTODO</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>GET</td>
      <td>https://apihml-corp.cielo.com.br /cielo-refunds-exp-hml/refunds/v1/refunds{refundID}/{merchantID}?limit={limit} &amp;offset={offset}</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>GET</td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds{refundID}/{merchantID}?limit={limit} &amp;offset={offset}</td>
    </tr>
  </tbody>
</table>

<p><strong>Exemplo de requisição em homologação:</strong></p>

<p>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds/140426/2005157770</p>

<p><strong>Request:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">/</span><span class="p">{</span><span class="err">refundID</span><span class="p">}</span><span class="err">/</span><span class="p">{</span><span class="err">merchantID</span><span class="p">}</span><span class="err">?limit=</span><span class="p">{</span><span class="err">limit</span><span class="p">}</span><span class="w"> </span><span class="err">&amp;offset=</span><span class="p">{</span><span class="err">offset</span><span class="p">}</span><span class="w">
</span><span class="err">refundID</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">identificador</span><span class="w"> </span><span class="err">devolvido</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">response</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">solicitação</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">cancelamento.</span><span class="w">
</span><span class="err">merchantID</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">número</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">EC</span><span class="w"> </span><span class="err">(estabelecimento</span><span class="w"> </span><span class="err">comercial)</span><span class="w">
</span><span class="err">limit</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">quantidade</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">solicitações</span><span class="w"> </span><span class="err">dentro</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">json</span><span class="w">
</span><span class="err">offset</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">paginação</span><span class="w">
</span></code></pre></div></div>

<p><strong>Response:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"refundID"</span><span class="p">:</span><span class="w"> </span><span class="mi">140426</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refundDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-10-09T15:31:19.000-0300"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"transactionID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20051577703PPIQIJ7FB"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"nsu"</span><span class="p">:</span><span class="w"> </span><span class="mi">515027</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cardNumberLast4Digits"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0034"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"merchantID"</span><span class="p">:</span><span class="w"> </span><span class="mi">2005157770</span><span class="p">,</span><span class="w">
            </span><span class="nl">"authorizationCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"546441"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"refundAmount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BRL"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"saleAmount"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BRL"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">70000.0</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"transactionDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-07-03T18:13:40.000-0300"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"controlID"</span><span class="p">:</span><span class="w"> </span><span class="mi">3506674</span><span class="p">,</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"done"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cancelamento aprovado com sucesso."</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>Descrição dos campos:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">**</span><span class="nl">"refundID"</span><span class="p">:</span><span class="err">**</span><span class="w"> </span><span class="err">Identificador</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">lote</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
</span><span class="err">**</span><span class="nl">"refundDate"</span><span class="p">:</span><span class="err">**</span><span class="w"> </span><span class="err">Data</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">solicitação</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cancelamento</span><span class="p">,</span><span class="w"> </span><span class="err">formato</span><span class="w"> </span><span class="err">exemplo:</span><span class="w"> </span><span class="mi">2019-12-27</span><span class="err">T</span><span class="mi">19</span><span class="err">:</span><span class="mi">38</span><span class="err">:</span><span class="mf">30.547</span><span class="err">Z</span><span class="w">
 </span><span class="err">**</span><span class="nl">"transactions"</span><span class="p">:</span><span class="err">**</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
</span><span class="err">**transactionID**=</span><span class="w"> </span><span class="err">identificador</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">transação</span><span class="w"> </span><span class="err">E-commerce.</span><span class="w">
</span><span class="err">**Nsu**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Número</span><span class="w"> </span><span class="err">sequencial</span><span class="w"> </span><span class="err">único.</span><span class="w">
</span><span class="err">**cardNumberLast</span><span class="mi">4</span><span class="err">Digits**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">os</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">últimos</span><span class="w"> </span><span class="err">dígitos</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cartão.</span><span class="w">
</span><span class="err">**merchantID**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">número</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">EC</span><span class="w"> </span><span class="err">(estabelecimento</span><span class="w"> </span><span class="err">comercial).</span><span class="w">
</span><span class="err">**authorizationCode**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Código</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">autorização</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda.</span><span class="w">
</span><span class="err">**refundAmount**:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">**currency**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">**BRL**.</span><span class="w">
        </span><span class="err">**value**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Valor</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelar</span><span class="p">,</span><span class="w"> </span><span class="err">pode</span><span class="w"> </span><span class="err">ser</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">valor</span><span class="w"> </span><span class="err">parcial</span><span class="w"> </span><span class="err">ou</span><span class="w"> </span><span class="err">total.</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="err">**saleAmount**:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">**currency**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">tipo</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">moeda</span><span class="w"> </span><span class="err">para</span><span class="w"> </span><span class="err">cancelamento</span><span class="w"> </span><span class="err">utilizar</span><span class="w"> </span><span class="err">somente</span><span class="w"> </span><span class="err">**BRL**.</span><span class="w">
        </span><span class="err">**value**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Valor</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda.</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="err">**transactionDate**</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">formato</span><span class="w"> </span><span class="err">DD-MM-YYYY</span><span class="w"> </span><span class="err">HH</span><span class="mi">24</span><span class="err">:MI:SS</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">venda.</span><span class="w"> </span><span class="nl">"**controlID**"</span><span class="p">:</span><span class="w"> </span><span class="err">identificador</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
      </span><span class="nl">"**status**"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"**type**"</span><span class="p">:</span><span class="w"> </span><span class="err">Status</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">solicitação</span><span class="w"> 
      </span><span class="p">}</span><span class="w">


</span><span class="err">**Caso</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">status</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">rejected:**</span><span class="w">
</span><span class="nl">"**detail**"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"**code**"</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Código</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">rejeição</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
          </span><span class="s2">"**message**"</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Motivo</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">rejeição</span><span class="w"> </span><span class="err">de</span><span class="w"> </span><span class="err">cancelamento</span><span class="w">
        </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>O status pending e approved não tem detail no json.</p>

<p><strong>Os retornos do tipo rejeição:</strong></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem28.png" alt="Imagem28" /></p>

<h1 id="consultar-cancelamento-por-timeout-na-requisição">Consultar Cancelamento por timeout na requisição</h1>

<p>Essa consulta deve ser executada somente quando houver problemas na comunicação durante a solicitação de cancelamento.</p>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>MÉTODO</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>GET</td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds?cancelStartDate={DD/MM/YYYY}&amp;cancelEndDate={DD/MM/YYYY}&amp;rows=25&amp;page=1&amp;merchantId={codigo_estabelecimento}&amp;authorizationCode={codigo_autorizacao}</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>GET</td>
      <td>https://api-corp.cielo.com.br/refunds-api/v1/refunds refunds/v1/refunds?cancelStartDate={DD/MM/YYYY}&amp;cancelEndDate={DD/MM/YYYY}&amp;rows=25&amp;page=1&amp;merchantId={codigo_estabelecimento}&amp;authorizationCode={codigo_autorizacao}</td>
    </tr>
  </tbody>
</table>

<p><strong>Exemplo Request:</strong></p>

<p>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds?cancelStartDate=09-10-2024&amp;cancelEndDate=10-10-2024&amp;rows=25&amp;page=1&amp;merchantId=2005157770&amp;authorizationCode=546441</p>

<p><strong>Request:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?cancelStartDate= {Data inicial}&amp;cancelEndDate={Data final}&amp;rows={linha}&amp;page={pagina}&amp;merchantId={Estabelecimento}&amp;authorizationCode={código de autorização}
**cancelStartDate** = Data inicial da solicitação de cancelamento (formato dd-MM-yyyy)
**cancelEndDate** = Data final da solicitação de cancelamento (formato dd-MM-yyyy)
**rows** = Quantidade de linhas
**page** = Paginação
**merchantId** = número do EC (estabelecimento comercial)
**authorizationCode** = Código de autorização da venda.
</code></pre></div></div>

<p><strong>Respose:</strong></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem29.png" alt="Imagem29" /></p>

<p><strong>Descrição dos campos:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
"**refundID**": Identificador do lote de cancelamento
 "**refundDate**": Data da solicitação do cancelamento, formato exemplo: 2019-12-27T19:38:30.547Z
 "**transactions**": [
        {
**transactionID** = identificador de transação E-commerce.
**Nsu** = Número sequencial único.
**cardNumberLast4Digits** = os 4 últimos dígitos do cartão.
**merchantID** = número do EC (estabelecimento comercial).
**authorizationCode** = Código de autorização da venda.
**refundAmount**: {
        **currency** = tipo de moeda para cancelamento utilizar somente **BRL**.
        **value** = Valor para cancelar, pode ser o valor parcial ou total.
      }
**saleAmount**: {
        **currency** = tipo de moeda para cancelamento utilizar somente **BRL**.
        **value** = Valor da venda.
      }
**transactionDate** = no formato DD-MM-YYYY HH24:MI:SS data da venda. "**controlID**": identificador do cancelamento
      "**status**": {
        "**type**": Status da solicitação 
      }

**Observações**:
O status pending e approved não tem detail no json.

Caso o status for rejected (Rejeição):
"**detail**": {
          "**code**" = Código da rejeição de cancelamento
          "**message**" = Motivo da rejeição de cancelamento
        }
</code></pre></div></div>

<h1 id="fluxo-de-cancelamento">Fluxo de Cancelamento</h1>

<h2 id="efetivação-de-cancelamento">Efetivação de Cancelamento</h2>

<p>A efetivação dos cancelamentos solicitados pela API é feita de forma assíncrona em processo batch com corte às 18h30 da tarde. O que significa que cancelamentos solicitados antes deste horário e que forem aprovados na validação de regras de negócio de cancelamento serão enviados para efetivação e terão seus status finais retornados na manhã do dia seguinte a partir das 8h (D1).</p>

<h2 id="status-códigos-e-mensagens-de-retorno">Status, Códigos e Mensagens de Retorno</h2>

<h3 id="status">Status</h3>

<p>A API de Cancelamento possui 4 tipos de status de cancelamento retornados.</p>

<table>
  <thead>
    <tr>
      <th>TYPE STATUS</th>
      <th>DESCRIÇÃO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong><em>Pending</em></strong></td>
      <td>Este status indica que a requisição foi recebida pelo sistema e está aguardando processamento. Neste caso, não há informação de retorno no campo details</td>
    </tr>
    <tr>
      <td><strong><em>Rejected</em></strong></td>
      <td>Este status indica que a solicitação de cancelamento não foi aprovada nas validações de regras de negócio de cancelamento. Neste caso, no campo details teremos informações complementares no campo Code e Message.</td>
    </tr>
  </tbody>
</table>

<p>“detail”: {
          “code” = Código da rejeição de cancelamento
          “message” = Motivo da rejeição de cancelamento
        }
|
| <strong><em>Done</em></strong> | Este Status indica que a solicitação teve sucesso na efetivação do Cancelamento e o cancelamento já foi liquidado. Neste caso, não há informação de retorno no campo details | 
| <strong><em>Failed</em></strong> | Este status indica alguma falha de comunicação entre sistemas.  Uma nova tentativa de cancelamento pode ser feita. |</p>

<h3 id="códigos-e-mensagens-de-retorno">Códigos e Mensagens de Retorno</h3>

<p>Nos cancelamentos com Status Rejected e Failed, temos informações de retorno no campo details. Os retornos possíveis são:</p>

<table>
  <thead>
    <tr>
      <th>COD</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>5</td>
      <td>Erro de efetivação.</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Cancelamento não efetuado. Não foi possivel localizar a venda com a identificação do cancelamento enviada.</td>
    </tr>
    <tr>
      <td>10</td>
      <td>Cancelamento não efetuado. Solicitação pendente com as mesmas informações.</td>
    </tr>
    <tr>
      <td>17</td>
      <td>Saldo da transação insuficiente para cancelamento da venda.</td>
    </tr>
    <tr>
      <td>51</td>
      <td>Cancelamento acima do valor origina da venda</td>
    </tr>
    <tr>
      <td>54</td>
      <td>Cancelamento não efetuado entre em contato com a Central de Atendimento</td>
    </tr>
    <tr>
      <td>56</td>
      <td>Saldo do Lojista Insuficiente para Cancelar</td>
    </tr>
    <tr>
      <td>72</td>
      <td>Saldo na Agenda insuficiente para cancelamento da venda. Ligue para Central ou Seu Gestor</td>
    </tr>
    <tr>
      <td>77</td>
      <td>Venda original não encontrada para cancelamento.</td>
    </tr>
    <tr>
      <td>99</td>
      <td>Falha no processamento. Por favor tente novamente.</td>
    </tr>
    <tr>
      <td>101</td>
      <td>Cancelamento não realizado, por estar acima do prazo permitido pela Bandeira</td>
    </tr>
    <tr>
      <td>102</td>
      <td>Cancelamento solicitado acima do valor da transação original.</td>
    </tr>
    <tr>
      <td>103</td>
      <td>Restrição Cadastral. Cancelamento não permitido. Entre em contato com a Central de Cancelamento.</td>
    </tr>
    <tr>
      <td>104</td>
      <td>Restrição Cadastral. Cancelamento não permitido. Entre em contato com a Central de Cancelamento.</td>
    </tr>
    <tr>
      <td>105</td>
      <td>Restrição Cadastral. Cancelamento não permitido. Entre em contato com a Central de Cancelamento.</td>
    </tr>
    <tr>
      <td>106</td>
      <td>Restrição Cadastral. Cancelamento não permitido. Entre em contato com a Central de Cancelamento.</td>
    </tr>
    <tr>
      <td>108</td>
      <td>Número do Estabelecimento (EC) não encontrado. Por favor verifique o número enviado.</td>
    </tr>
    <tr>
      <td>109</td>
      <td>Produto Débito só permite cancelamento total.</td>
    </tr>
    <tr>
      <td>115</td>
      <td>Requisição inválida.</td>
    </tr>
    <tr>
      <td>120</td>
      <td>Produto da venda não permite cancelamento.</td>
    </tr>
    <tr>
      <td>200</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com os dados enviados do cartão.</td>
    </tr>
    <tr>
      <td>201</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com o NSU enviado.</td>
    </tr>
    <tr>
      <td>203</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com a data enviada.</td>
    </tr>
    <tr>
      <td>206</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com o valor da venda enviado.</td>
    </tr>
    <tr>
      <td>209</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com o produto enviado.</td>
    </tr>
    <tr>
      <td>214</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com o status enviado.</td>
    </tr>
    <tr>
      <td>215</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com a bandeira enviada.</td>
    </tr>
    <tr>
      <td>216</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com os dados enviados do cartão.</td>
    </tr>
    <tr>
      <td>217</td>
      <td>Cancelamento não efetuado. Foi localizado mais de uma venda com os dados enviados.</td>
    </tr>
    <tr>
      <td>218</td>
      <td>Cancelamento não efetuado. Usuário inválido.</td>
    </tr>
    <tr>
      <td>219</td>
      <td>Cancelamento não efetuado. Sistema de liquidação inválido.</td>
    </tr>
    <tr>
      <td>221</td>
      <td>Cancelamento não efetuado. Não foi possível localizar a venda com o valor do cancelamento enviado.</td>
    </tr>
    <tr>
      <td>222</td>
      <td>Cancelamento não efetuado. Não foi possível identificar o canal solicitante.</td>
    </tr>
    <tr>
      <td>223</td>
      <td>Cancelamento não efetuado. Solicitação pendente com as mesmas informações.</td>
    </tr>
    <tr>
      <td>224</td>
      <td>Cancelamento não efetuado. Não foi possivel identificar o ramo de atividade enviado.</td>
    </tr>
    <tr>
      <td>225</td>
      <td>Cancelamento não efetuado. Não foi possivel localizar a venda com o NSU da venda enviado.</td>
    </tr>
    <tr>
      <td>476</td>
      <td>Cancelamento não realizado. Existe um cancelamento para esta venda em processamento.</td>
    </tr>
    <tr>
      <td>477</td>
      <td>Cancelamento não efetivado.</td>
    </tr>
    <tr>
      <td>800</td>
      <td>Operação não permitida. Envio Automático de carta permitido apenas para Cliente.</td>
    </tr>
    <tr>
      <td>801</td>
      <td>Operação não permitida. Parametrização existente.</td>
    </tr>
    <tr>
      <td>802</td>
      <td>Falha ao consultar dados cadastrais.</td>
    </tr>
    <tr>
      <td>803</td>
      <td>Cliente não localizado nos dados cadastrais.</td>
    </tr>
    <tr>
      <td>823</td>
      <td>Solicitação reprovada por decurso de prazo.</td>
    </tr>
  </tbody>
</table>

<p><strong>Retorno do tipo Failed:</strong></p>

<p>Neste caso é só fazer uma nova requisição:</p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem30.png" alt="Imagem30" /></p>

<p><strong>Retorno do tipo Done:</strong></p>

<p><img src="https://desenvolvedores.cielo.com.br/api-portal/sites/default/files/Imagem31.png" alt="Imagem31" /></p>

<h1 id="carta-de-cancelamento">Carta de Cancelamento</h1>

<p>Só será possível gerar a carta de cancelamento quando o status type for igual a done. Ou seja, só será possível gerar a carta de cancelamento quando a solicitação estiver efetivada.</p>

<p>É possível solicitar a geração e carta por unidade ou lote.</p>

<p>A geração de carta pode ser gerada no idioma português ou inglês.</p>

<p>Não é possível gerar cartas em lote mesclados nos idiomas português e inglês.</p>

<p>Nas requisições de carta por lote, o limite é de 10 cartas por requisição.</p>

<p>Não é possível gerar um lote de cartas para ECs diferentes, na mesma requisição.</p>

<h2 id="solicitação-de-carta-por-unidade">Solicitação de Carta por unidade</h2>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>MÉTODO</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>GET</td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds/v1/refunds/v1/letter-api/pdf</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>GET</td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds/v1/letter-api/pdf</td>
    </tr>
  </tbody>
</table>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"merchantId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cancellationId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PT_BR"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>No campo <strong>merchantId</strong> é necessário informar o número do estabelecimento (EC), do tipo number, este campo é obrigatório.</p>

<p>O Campo <strong>cancellationId</strong> é necessário informar o controlId, do tipo number, este campo é obrigatório.</p>

<p>O campo <strong>language</strong> é opcional, mantendo como default o idioma português, podendo também usar como o PT_BR para português ou EN_US para inglês.</p>

<p><strong>Response em caso de erro:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"errorCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="p">,</span><span class="w">
  </span><span class="nl">"errorMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"You don't have sufficient credentials to perform this operation"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-04-23T18:25:43.511Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="solicitação-de-carta-por-lote">Solicitação de Carta por lote</h2>

<table>
  <thead>
    <tr>
      <th>AMBIENTE</th>
      <th>MÉTODO</th>
      <th>ENDPOINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Homologação</strong></td>
      <td>GET</td>
      <td>https://apihml-corp.cielo.com.br/cielo-refunds-exp-hml/refunds /v1/refunds/v1/letter-api/zip</td>
    </tr>
    <tr>
      <td><strong>Produção</strong></td>
      <td>GET</td>
      <td>https://api-corp.cielo.com.br/cielo-refunds-exp/refunds/v1/refunds/v1/letter-api/zip</td>
    </tr>
  </tbody>
</table>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"merchantId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cancellations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PT_BR"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>No campo <strong>merchantId</strong> é necessário informar o número do estabelecimento (EC), do tipo number, este campo é obrigatório.</p>

<p>O Campo <strong>cancellationId</strong> é necessário informar uma lista de controlId, separado por virgula (“,”), do tipo number, este campo é obrigatório.</p>

<p>O campo <strong>language</strong> é opcional, mantendo como default o idioma português, podendo também usar como o PT_BR para português ou EN_US para inglês.</p>

<h1 id="suporte-cielo">Suporte Cielo</h1>

<p>Caso tenha dúvidas, envie um e-mail para: <strong>api.cancelamento@cielo.com.br</strong></p>

<h1 id="faq---perguntas-frequentes">FAQ - Perguntas Frequentes</h1>

<p><strong>O que fazer se o token expirar?</strong></p>

<p>Obtenha um novo token JWT repetindo o processo de autenticação descrito no passo (Fluxo de Autenticação de Credenciais do Cliente)</p>

<p><strong>Como testar sem impactar o ambiente de produção?</strong></p>

<p>Use a URL de homologação fornecida no passo (Acesso aos endpoints da Cielo).</p>

<p><strong>Posso reutilizar o mesmo token para múltiplas requisições?</strong></p>

<p>Sim, desde que ele ainda esteja válido (duração: 5 minutos). Caso expire, gere um novo token.</p>

<p><strong>Ao integrar na API de Cancelamento, ainda poderei solicitar cancelamento por outros Canais?</strong></p>

<p>Sim. A API é mais uma opção de canal para solicitar cancelamento de vendas. Os demais canais continuarão disponíveis para solicitação de cancelamento (POS, TEF, e-commerce, Central de Atendimento, Site/APP).</p>

<p>Atente-se para envio de cancelamentos parciais por 2 canais diferentes. Havendo saldo disponível na transação, as duas solicitações podem ser efetivadas.</p>

<p><strong>É possível enviar cancelamentos parciais pela API de Cancelamento?</strong></p>

<p>Sim. É possível enviar um ou mais cancelamentos parciais de uma mesma transação pela API. As solicitações serão efetivadas respeitando o saldo disponível na transação e as regras de cancelamento de cada Bandeira.</p>

<p>Débito Mastercard só permite um cancelamento parcial por transação. Em caso de 2ª solicitação de cancelamento, ela será rejeitada por regra da bandeira.</p>

<p><strong>Qual o prazo de efetivação de cancelamento solicitado via API de Cancelamento?</strong></p>

<p>Cancelamentos solicitados no mesmo dia da venda terão o status final disponível a partir das 8h da manhã de D2.</p>

<p>Cancelamentos solicitados após a data da venda, caso solicitados até as 18h30 terão seu status final disponível a partir das 8h da manhã de D1.</p>

<p><strong>Qual a diferença entre API Única de Cancelamento e a API E-Commerce?</strong></p>

<p>API Única de Cancelamento e a API E-commerce são soluções diferentes com propósitos e integrações diferentes.</p>

<p>A API E-commerce é uma solução de captura que também permite solicitação de cancelamentos de vendas e-commerce. Só é permitido cancelar vendas e-commerce do EC integrado</p>

<p>A API Única de cancelamento é uma solução cujo objetivo é permitir clientes centralizarem cancelamentos de diversas soluções de captura oferecidas pelas Cielo (TEF, POS, E-commerce, LIO). A integração é por Raiz de CNPJ e é possível cancelar vendas de todos os ECs que compõem essa Raiz.</p>

</div>


            <div class="footer-conteudo">
  <div id="footer-conteudo-img" class="col-lg-1 col-md-1">
    <img
      src="https://developercielo.github.io/assets/images/icon-doubt.svg"
      width="55px"
      height="53px"
      alt="Precisa de ajuda?"
    />
  </div>

  <div id="footer-conteudo-texto" class="col-lg-11 col-md-11">
    <h2>Precisa de ajuda?</h2>
    <p>Se você não conseguiu encontrar sua resposta acima, <a href="https://devcielo.zendesk.com/hc/pt-br#suporte">entre em contato conosco</a>.</p>
  </div>
</div>

        </div>

        <div class="sidebar">
  <div class="sidebar-sticky">
    <div class="sidebar-about">
      <a
        title="Comutar a coluna da esquerda"
        class="hamburger"
      >
        <i class="fa fa-bars hamb-menu" aria-hidden="true"></i>
      </a>
      <a href="https://desenvolvedores.cielo.com.br" target="_blank">
        <img
          src="https://developercielo.github.io/assets/images/logo.png"
          alt="Documentações e tutoriais"
          style="width: 60%; margin-left: 20%"
        />
      </a>
      <div></div>
    </div>

    <div id="toc"></div>

    <div class="fixed-footer">
      

      <div class="toc-contact">
        <div class="contact">
          <a
            title="Contato"
            href="https://devcielo.zendesk.com/"
          >
            <i class="fa fa-envelope-o" aria-hidden="true"></i>
            <span>Contato</span>
          </a>
        </div>
        <div class="github">
          <a title="GitHub" href="https://github.com/developercielo">
            <i class="fa fa-github" aria-hidden="true"></i>
            <span>GitHub</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>


        <script src="https://developercielo.github.io/assets/bundles/js/bundle.min.js"></script>
        <script>
            
            var selectors = 'h1,h2,h3,h4,h5,h6';
            
        </script>

        
        <script src="https://developercielo.github.io/assets/bundles/js/search.min.js"></script>
        

        
        <script>
            let langs = '';
            let langsArray = [];

            
            langs += "<a data-language-name='json'>JSON</a>";
            langsArray.push('json');
            

            var toggleCode = 'Comutar';
        </script>

        <script src='https://developercielo.github.io/assets/bundles/js/language_buttons.min.js'></script>
        

        <!-- Hotjar Tracking Code for https://developercielo.github.io/ -->
<script>
  (function (h, o, t, j, a, r) {
    h.hj =
      h.hj ||
      function () {
        (h.hj.q = h.hj.q || []).push(arguments);
      };
    h._hjSettings = { hjid: 674586, hjsv: 6 };
    a = o.getElementsByTagName("head")[0];
    r = o.createElement("script");
    r.async = 1;
    r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
    a.appendChild(r);
  })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
</script>

    </body>
</html>
